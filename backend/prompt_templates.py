from langchain.prompts import PromptTemplate
from typing import Dict, Any


class PromptTemplates:
    def __init__(self):
        """åˆå§‹åŒ–æ‰€æœ‰Stage1çš„æç¤ºè¯æ¨¡æ¿"""
        self._init_base_templates()
        self._init_dynamic_templates()

    def _init_base_templates(self):
        """åˆå§‹åŒ–åŸºç¡€æç¤ºè¯æ¨¡æ¿"""

        # åŸºç¡€ä¿¡æ¯æ”¶é›†æ¨¡æ¿
        self.basic_info_prompt = PromptTemplate(
            input_variables=["history", "input"],
            template="""ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²æ¸¸æˆè®¾è®¡åŠ©æ‰‹ã€‚ç°åœ¨éœ€è¦æ”¶é›†åŸºç¡€ä¿¡æ¯æ¥è®¾è®¡RPGæ•™è‚²æ¸¸æˆã€‚

å¯¹è¯å†å²ï¼š
{history}

å½“å‰ä»»åŠ¡ï¼šæ”¶é›†åŸºç¡€ä¿¡æ¯
éœ€è¦äº†è§£çš„ä¿¡æ¯ï¼š
- ç›®æ ‡å¹´çº§ï¼ˆå¦‚ï¼šä¸€å¹´çº§ã€äºŒå¹´çº§ã€ä¸‰å¹´çº§ç­‰ï¼‰
- å­¦ç§‘é¢†åŸŸï¼ˆå¦‚ï¼šæ•°å­¦ã€è¯­æ–‡ã€è‹±è¯­ã€ç§‘å­¦ç­‰ï¼‰
- å…·ä½“çŸ¥è¯†ç‚¹ï¼ˆå¦‚ï¼š10ä»¥å†…åŠ æ³•ã€æ±‰è¯­æ‹¼éŸ³ã€è‹±è¯­å­—æ¯ç­‰ï¼‰

ç”¨æˆ·è¾“å…¥ï¼š{input}

è¯·å‹å¥½åœ°å¼•å¯¼ç”¨æˆ·æä¾›è¿™äº›åŸºç¡€ä¿¡æ¯ã€‚å¦‚æœç”¨æˆ·å·²ç»æåˆ°äº†éƒ¨åˆ†ä¿¡æ¯ï¼Œè¯·ç¡®è®¤å¹¶è¯¢é—®ç¼ºå¤±çš„éƒ¨åˆ†ã€‚ä¿æŒå¯¹è¯è‡ªç„¶æµç•…ï¼Œä¸€æ¬¡ä¸è¦é—®å¤ªå¤šé—®é¢˜ã€‚

åŠ©æ‰‹å›å¤ï¼š"""
        )

        # æ•™å­¦ä¿¡æ¯æ”¶é›†æ¨¡æ¿
        self.teaching_info_prompt = PromptTemplate(
            input_variables=["history", "input"],
            template="""ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²æ¸¸æˆè®¾è®¡åŠ©æ‰‹ã€‚åŸºç¡€ä¿¡æ¯å·²ç»æ”¶é›†å®Œæˆï¼Œç°åœ¨éœ€è¦æ·±å…¥äº†è§£æ•™å­¦éœ€æ±‚ã€‚

å¯¹è¯å†å²ï¼š
{history}

å½“å‰ä»»åŠ¡ï¼šäº†è§£æ•™å­¦ç›®æ ‡å’Œéš¾ç‚¹
éœ€è¦äº†è§£çš„ä¿¡æ¯ï¼š
- å…·ä½“çš„æ•™å­¦ç›®æ ‡ï¼ˆå­¦ç”Ÿé€šè¿‡æ¸¸æˆè¦è¾¾åˆ°ä»€ä¹ˆå­¦ä¹ æ•ˆæœï¼Ÿï¼‰
- æ•™å­¦éš¾ç‚¹ï¼ˆå­¦ç”Ÿåœ¨è¿™ä¸ªçŸ¥è¯†ç‚¹ä¸Šé€šå¸¸æœ‰ä»€ä¹ˆå›°éš¾ï¼Ÿï¼‰
- æœŸæœ›çš„å­¦ä¹ æˆæœ

ç”¨æˆ·è¾“å…¥ï¼š{input}

è¯·æ·±å…¥äº†è§£ç”¨æˆ·çš„æ•™å­¦éœ€æ±‚ï¼Œé‡ç‚¹å…³æ³¨å­¦ç”Ÿçš„å­¦ä¹ å›°éš¾å’ŒæœŸæœ›è¾¾æˆçš„æ•™å­¦ç›®æ ‡ã€‚

åŠ©æ‰‹å›å¤ï¼š"""
        )

        # æ¸¸æˆé£æ ¼æ”¶é›†æ¨¡æ¿
        self.gamestyle_info_prompt = PromptTemplate(
            input_variables=["history", "input"],
            template="""ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²æ¸¸æˆè®¾è®¡åŠ©æ‰‹ã€‚ç°åœ¨éœ€è¦ç¡®å®šæ¸¸æˆçš„é£æ ¼å’Œè®¾å®šã€‚

å¯¹è¯å†å²ï¼š
{history}

å½“å‰ä»»åŠ¡ï¼šè®¾è®¡æ¸¸æˆé£æ ¼å’Œè§’è‰²è®¾å®š
éœ€è¦äº†è§£çš„ä¿¡æ¯ï¼š
- æ¸¸æˆé£æ ¼åå¥½ï¼ˆå¦‚ï¼šé­”æ³•å†’é™©ã€ç§‘å¹»æ¢ç´¢ã€ç«¥è¯æ•…äº‹ã€å†å²ç©¿è¶Šç­‰ï¼‰
- è§’è‰²è®¾è®¡æƒ³æ³•ï¼ˆå¦‚ï¼šå¯çˆ±çš„å°åŠ¨ç‰©ã€å‹‡æ•¢çš„å°å‹‡å£«ã€æ™ºæ…§çš„å¯¼å¸ˆç­‰ï¼‰
- ä¸–ç•Œè§‚èƒŒæ™¯ï¼ˆå¦‚ï¼šé­”æ³•æ£®æ—ã€æœªæ¥ä¸–ç•Œã€ç«¥è¯ç‹å›½ç­‰ï¼‰

ç”¨æˆ·è¾“å…¥ï¼š{input}

è¯·å¸®åŠ©ç”¨æˆ·ç¡®å®šæ¸¸æˆçš„è§†è§‰é£æ ¼å’Œè§’è‰²è®¾å®šï¼Œè®©æ¸¸æˆæ›´æœ‰å¸å¼•åŠ›ã€‚

åŠ©æ‰‹å›å¤ï¼š"""
        )

        # æƒ…èŠ‚éœ€æ±‚æ”¶é›†æ¨¡æ¿
        self.scene_info_prompt = PromptTemplate(
            input_variables=["history", "input"],
            template="""ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²æ¸¸æˆè®¾è®¡åŠ©æ‰‹ã€‚æœ€åéœ€è¦ç¡®å®šå…·ä½“çš„æƒ…èŠ‚å’Œäº’åŠ¨éœ€æ±‚ã€‚

å¯¹è¯å†å²ï¼š
{history}

å½“å‰ä»»åŠ¡ï¼šè®¾è®¡æƒ…èŠ‚å‘å±•å’Œäº’åŠ¨æ–¹å¼
éœ€è¦äº†è§£çš„è¯¦ç»†ä¿¡æ¯ï¼š
ã€æƒ…èŠ‚éœ€æ±‚ã€‘
- æ•…äº‹ä¸»çº¿ï¼šä¸»è§’çš„ç›®æ ‡å’ŒåŠ¨æœºï¼ˆå¦‚ï¼šæ‹¯æ•‘è¢«å›°çš„æœ‹å‹ã€å¯»æ‰¾å¤±è½çš„å®è—ã€å®Œæˆå­¦ä¹ ä»»åŠ¡ï¼‰
- æƒ…èŠ‚ç»“æ„ï¼šæ•…äº‹å‘å±•æ–¹å¼ï¼ˆå¦‚ï¼šçº¿æ€§é—¯å…³ã€åˆ†æ”¯é€‰æ‹©ã€å¼€æ”¾æ¢ç´¢ï¼‰
- å†²çªè®¾ç½®ï¼šå­¦ä¹ æŒ‘æˆ˜çš„å‘ˆç°å½¢å¼ï¼ˆå¦‚ï¼šè§£è°œéšœç¢ã€çŸ¥è¯†ç«èµ›ã€åˆä½œä»»åŠ¡ï¼‰
- è§’è‰²å…³ç³»ï¼šä¸»è§’ä¸NPCçš„äº’åŠ¨ç±»å‹ï¼ˆå¦‚ï¼šå¸ˆç”Ÿå…³ç³»ã€ä¼™ä¼´åä½œã€ç«äº‰å¯¹æ‰‹ï¼‰
- æƒ…æ„ŸåŸºè°ƒï¼šå¸Œæœ›è¥é€ çš„æ°›å›´ï¼ˆå¦‚ï¼šè½»æ¾æ„‰å¿«ã€ç´§å¼ åˆºæ¿€ã€æ¸©é¦¨æ„Ÿäººï¼‰

ã€äº’åŠ¨æ–¹å¼ã€‘
- æ“ä½œæ–¹å¼åå¥½ï¼ˆå¦‚ï¼šé€‰æ‹©é¢˜ç­”é¢˜ã€æ‹–æ‹½æ“ä½œã€è¯­éŸ³äº’åŠ¨ç­‰ï¼‰
- è¯„ä¼°å’Œå¥–åŠ±æœºåˆ¶æƒ³æ³•

ç”¨æˆ·è¾“å…¥ï¼š{input}

è¯·è¯¦ç»†äº†è§£ç”¨æˆ·å¯¹æ¸¸æˆæƒ…èŠ‚å‘å±•å’Œäº’åŠ¨æ–¹å¼çš„å…·ä½“æƒ³æ³•ï¼Œç¡®ä¿æ¸¸æˆæ—¢æœ‰å®Œæ•´çš„æ•…äº‹æ€§åˆæœ‰æ•™è‚²æ„ä¹‰ã€‚

åŠ©æ‰‹å›å¤ï¼š"""
        )

        # å®Œæˆç¡®è®¤æ¨¡æ¿
        self.completion_prompt = PromptTemplate(
            input_variables=["history", "input"],
            template="""ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²æ¸¸æˆè®¾è®¡åŠ©æ‰‹ã€‚ä¿¡æ¯æ”¶é›†å³å°†å®Œæˆï¼

å¯¹è¯å†å²ï¼š
{history}

å½“å‰çŠ¶æ€ï¼šä¿¡æ¯æ”¶é›†åŸºæœ¬å®Œæˆ
ä»»åŠ¡ï¼šç¡®è®¤ä¿¡æ¯å¹¶å‡†å¤‡ç”Ÿæˆæ¸¸æˆå†…å®¹

ç”¨æˆ·è¾“å…¥ï¼š{input}

è¯·æ€»ç»“æ”¶é›†åˆ°çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå‘ç”¨æˆ·ç¡®è®¤æ˜¯å¦å‡†ç¡®ï¼Œç„¶åå‡†å¤‡è¿›å…¥æ¸¸æˆå†…å®¹ç”Ÿæˆé˜¶æ®µã€‚

åŠ©æ‰‹å›å¤ï¼š"""
        )

        # é»˜è®¤æ¨¡æ¿
        self.default_prompt = PromptTemplate(
            input_variables=["history", "input"],
            template="""ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²æ¸¸æˆè®¾è®¡åŠ©æ‰‹ã€‚

å¯¹è¯å†å²ï¼š
{history}

ç”¨æˆ·è¾“å…¥ï¼š{input}

è¯·æ ¹æ®å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œå‹å¥½åœ°å›åº”ç”¨æˆ·å¹¶ç»§ç»­æ”¶é›†æ•™è‚²æ¸¸æˆè®¾è®¡æ‰€éœ€çš„ä¿¡æ¯ã€‚

åŠ©æ‰‹å›å¤ï¼š"""
        )

    def _init_dynamic_templates(self):
        """åˆå§‹åŒ–åŠ¨æ€æ¨¡æ¿çš„åŸºç¡€ç»“æ„"""

        # åŠ¨æ€æ¨¡æ¿çš„åŸºç¡€æ¡†æ¶
        self.dynamic_template_base = """ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²æ¸¸æˆè®¾è®¡åŠ©æ‰‹ã€‚

            å½“å‰æ”¶é›†é˜¶æ®µï¼š{stage_name}
            å·²æ”¶é›†ä¿¡æ¯ï¼š
            {collected_info}
            
            è¿˜éœ€è¦äº†è§£ï¼š
            {missing_info}
            
            å¯¹è¯å†å²ï¼š
            {history}
            
            ç”¨æˆ·è¾“å…¥ï¼š{input}
            
            {stage_guidance}
            
            è¯·æ ¹æ®ç¼ºå¤±çš„ä¿¡æ¯é‡ç‚¹è¯¢é—®ï¼Œä¿æŒå¯¹è¯è‡ªç„¶å‹å¥½ã€‚
            
            åŠ©æ‰‹å›å¤ï¼š"""

    def get_prompt_by_stage(self, stage: str) -> PromptTemplate:
        """æ ¹æ®é˜¶æ®µåç§°è·å–å¯¹åº”çš„promptæ¨¡æ¿"""
        stage_mapping = {
            "basic_info": self.basic_info_prompt,
            "teaching_info": self.teaching_info_prompt,
            "gamestyle_info": self.gamestyle_info_prompt,
            "scene_info": self.scene_info_prompt,
            "complete": self.completion_prompt
        }

        return stage_mapping.get(stage, self.default_prompt)

    def generate_dynamic_prompt(self, stage: str, collected_info: Dict[str, Any],
                                lacked_info: Dict[str, Any]) -> PromptTemplate:
        """åŸºäºæ”¶é›†çŠ¶æ€åŠ¨æ€ç”Ÿæˆprompt"""

        # æ ¼å¼åŒ–å·²æ”¶é›†ä¿¡æ¯
        collected_summary = self._format_collected_info(collected_info, stage)

        # æ ¼å¼åŒ–ç¼ºå¤±ä¿¡æ¯
        missing_summary = self._format_missing_info(lacked_info)
        print(f"missing summary is {missing_summary}")
        # ç”Ÿæˆé˜¶æ®µæŒ‡å¯¼è¯­
        stage_guidance = self._generate_stage_guidance(stage, lacked_info)

        # é˜¶æ®µåç§°æ˜ å°„
        stage_names = {
            "basic_info": "åŸºç¡€ä¿¡æ¯æ”¶é›†",
            "teaching_info": "æ•™å­¦éœ€æ±‚äº†è§£",
            "gamestyle_info": "æ¸¸æˆé£æ ¼è®¾å®š",
            "scene_info": "åœºæ™¯äº’åŠ¨è®¾è®¡"
        }

        return PromptTemplate(
            input_variables=["history", "input"],
            template=self.dynamic_template_base,
            partial_variables={
                "stage_name": stage_names.get(stage, stage),
                "collected_info": collected_summary,
                "missing_info": missing_summary,
                "stage_guidance": stage_guidance
            }
        )

    def _format_collected_info(self, collected_info: Dict[str, Any], stage: str) -> str:
        """æ ¼å¼åŒ–å·²æ”¶é›†çš„ä¿¡æ¯"""
        if not any(collected_info.values()):
            return "æš‚æ— ä¿¡æ¯"

        formatted_sections = []

        # åŸºç¡€ä¿¡æ¯éƒ¨åˆ†
        basic_items = []
        if collected_info.get("subject"):
            basic_items.append(f"âœ“ å­¦ç§‘ï¼š{collected_info['subject']}")
        if collected_info.get("grade"):
            basic_items.append(f"âœ“ å¹´çº§ï¼š{collected_info['grade']}")
        if collected_info.get("knowledge_points"):
            points = "ã€".join(collected_info['knowledge_points'])
            basic_items.append(f"âœ“ çŸ¥è¯†ç‚¹ï¼š{points}")

        if basic_items:
            formatted_sections.append("ã€åŸºç¡€ä¿¡æ¯ã€‘\n" + "\n".join(basic_items))

        # æ•™å­¦ä¿¡æ¯éƒ¨åˆ†
        teaching_items = []
        if collected_info.get("teaching_goals"):
            goals = "ã€".join(collected_info['teaching_goals'])
            teaching_items.append(f"âœ“ æ•™å­¦ç›®æ ‡ï¼š{goals}")
        if collected_info.get("teaching_difficulties"):
            difficulties = "ã€".join(collected_info['teaching_difficulties'])
            teaching_items.append(f"âœ“ æ•™å­¦éš¾ç‚¹ï¼š{difficulties}")

        if teaching_items:
            formatted_sections.append("ã€æ•™å­¦éœ€æ±‚ã€‘\n" + "\n".join(teaching_items))

        # æ¸¸æˆè®¾å®šéƒ¨åˆ†
        gamestyle_items = []
        if collected_info.get("game_style"):
            gamestyle_items.append(f"âœ“ æ¸¸æˆé£æ ¼ï¼š{collected_info['game_style']}")
        if collected_info.get("character_design"):
            gamestyle_items.append(f"âœ“ è§’è‰²è®¾è®¡ï¼š{collected_info['character_design']}")
        if collected_info.get("world_setting"):
            gamestyle_items.append(f"âœ“ ä¸–ç•ŒèƒŒæ™¯ï¼š{collected_info['world_setting']}")

        if gamestyle_items:
            formatted_sections.append("ã€æ¸¸æˆè®¾å®šã€‘\n" + "\n".join(gamestyle_items))

        # æƒ…èŠ‚éœ€æ±‚éƒ¨åˆ†
        scene_items = []
        if collected_info.get("plot_requirements"):
            plots = "ã€".join(collected_info['plot_requirements'])
            scene_items.append(f"âœ“ æƒ…èŠ‚éœ€æ±‚ï¼š{plots}")
        if collected_info.get("interaction_requirements"):
            interactions = "ã€".join(collected_info['interaction_requirements'])
            scene_items.append(f"âœ“ äº’åŠ¨æ–¹å¼ï¼š{interactions}")

        if scene_items:
            formatted_sections.append("ã€æƒ…èŠ‚è®¾è®¡ã€‘\n" + "\n".join(scene_items))

        return "\n\n".join(formatted_sections) if formatted_sections else "æš‚æ— ä¿¡æ¯"

    def _format_missing_info(self, lacked_info: Dict[str, Any]) -> str:
        """æ ¼å¼åŒ–ç¼ºå¤±ä¿¡æ¯"""
        missing_details = lacked_info.get("missing_details", {})
        if not missing_details:
            return "ä¿¡æ¯æ”¶é›†å®Œæˆ"

        missing_items = []
        for field, description in missing_details.items():
            missing_items.append(f"â€¢ {description}")

        return "\n".join(missing_items)

    def _generate_stage_guidance(self, stage: str, lacked_info: Dict[str, Any]) -> str:
        """ç”Ÿæˆé’ˆå¯¹æ€§çš„é˜¶æ®µæŒ‡å¯¼è¯­"""
        completion_rate = lacked_info.get("completion_rate", 0)
        missing_count = len(lacked_info.get("missing_fields", []))

        # åŸºç¡€é¼“åŠ±è¯­
        if completion_rate == 0:
            base_encouragement = "è®©æˆ‘ä»¬å¼€å§‹æ”¶é›†ä¿¡æ¯å§ï¼"
        elif completion_rate < 0.5:
            base_encouragement = f"å¾ˆå¥½ï¼è¿˜éœ€è¦äº†è§£{missing_count}ä¸ªæ–¹é¢çš„ä¿¡æ¯ã€‚"
        elif completion_rate < 1.0:
            base_encouragement = f"éå¸¸æ£’ï¼æˆ‘ä»¬å¿«å®Œæˆäº†ï¼Œè¿˜éœ€è¦{missing_count}ä¸ªä¿¡æ¯ã€‚"
        else:
            base_encouragement = "ä¿¡æ¯æ”¶é›†å®Œæˆï¼Œè®©æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚"

        # æ ¹æ®å…·ä½“ç¼ºå¤±å­—æ®µç”Ÿæˆç²¾ç¡®æŒ‡å¯¼
        missing_fields = lacked_info.get("missing_fields", [])
        
        field_guidance = {
            # basic_infoå­—æ®µ
            "subject": "è¯·æ˜ç¡®å­¦ç§‘é¢†åŸŸ",
            "grade": "è¯·ç¡®è®¤ç›®æ ‡å¹´çº§", 
            "knowledge_points": "è¯·è¯¦ç»†è¯´æ˜è¦å­¦ä¹ çš„çŸ¥è¯†ç‚¹",
            
            # teaching_infoå­—æ®µ
            "teaching_goals": "è¯·è¯´æ˜å¸Œæœ›å­¦ç”Ÿé€šè¿‡æ¸¸æˆè¾¾åˆ°çš„å­¦ä¹ ç›®æ ‡",
            "teaching_difficulties": "è¯·å‘Šè¯‰æˆ‘å­¦ç”Ÿåœ¨è¿™ä¸ªçŸ¥è¯†ç‚¹ä¸Šçš„å¸¸è§å›°éš¾",
            
            # gamestyle_infoå­—æ®µ  
            "game_style": "è¯·æè¿°æ‚¨åå¥½çš„æ¸¸æˆé£æ ¼",
            "character_design": "è¯·è¯´æ˜å¸Œæœ›çš„è§’è‰²è®¾è®¡",
            "world_setting": "è¯·æè¿°æ¸¸æˆçš„ä¸–ç•ŒèƒŒæ™¯è®¾å®š",
            
            # scene_infoå­—æ®µ  
            "plot_requirements": "è¯·è¯¦ç»†æè¿°å¸Œæœ›çš„æƒ…èŠ‚å‘å±•ï¼ŒåŒ…æ‹¬æ•…äº‹ä¸»çº¿ã€æƒ…èŠ‚ç»“æ„ã€å†²çªè®¾ç½®ã€è§’è‰²å…³ç³»å’Œæƒ…æ„ŸåŸºè°ƒ",
            "interaction_requirements": "è¯·è¯´æ˜åå¥½çš„äº’åŠ¨æ–¹å¼å’Œè¯„ä¼°æœºåˆ¶"
        }
        
        if missing_fields:
            specific_guidances = [field_guidance.get(field, f"è¯·æä¾›{field}ä¿¡æ¯") for field in missing_fields]
            specific_guidance = "é‡ç‚¹å…³æ³¨ï¼š" + "ã€".join(specific_guidances) + "ã€‚"
        else:
            specific_guidance = ""

        return f"{base_encouragement} {specific_guidance}".strip()

    def get_sufficiency_assessment_prompt(self) -> PromptTemplate:
        """è·å–ä¿¡æ¯è¯¦ç»†åº¦è¯„ä¼°æ¨¡æ¿"""
        template = """ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²æ¸¸æˆè®¾è®¡è¯„ä¼°ä¸“å®¶ã€‚è¯·è¯„ä¼°ä»¥ä¸‹æ”¶é›†åˆ°çš„ä¿¡æ¯æ˜¯å¦è¶³å¤Ÿè¯¦ç»†ï¼Œèƒ½å¤Ÿç”¨æ¥ç”Ÿæˆé«˜è´¨é‡çš„æ•™è‚²æ¸¸æˆå†…å®¹ã€‚

å·²æ”¶é›†ä¿¡æ¯ï¼š
{collected_info}

å¯¹è¯ä¸Šä¸‹æ–‡ï¼š
{conversation_context}

è¯·ä»ä»¥ä¸‹4ä¸ªç»´åº¦è¯„ä¼°ä¿¡æ¯çš„è¯¦ç»†åº¦å……è¶³æ€§ï¼Œæ¯ä¸ªç»´åº¦ç»™å‡º0-100åˆ†çš„è¯„åˆ†å’Œå…·ä½“ç†ç”±ï¼š

1. **åŸºç¡€ä¿¡æ¯å……è¶³æ€§** (å­¦ç§‘ã€å¹´çº§ã€çŸ¥è¯†ç‚¹çš„æ˜ç¡®æ€§å’Œå…·ä½“æ€§)
2. **æ•™å­¦ä¿¡æ¯å……è¶³æ€§** (æ•™å­¦ç›®æ ‡å’Œéš¾ç‚¹çš„æ¸…æ™°åº¦å’Œå¯æ“ä½œæ€§) 
3. **æ¸¸æˆè®¾å®šå……è¶³æ€§** (æ¸¸æˆé£æ ¼ã€è§’è‰²ã€ä¸–ç•Œè§‚çš„å®Œæ•´æ€§å’Œå¸å¼•åŠ›)
4. **æƒ…èŠ‚è®¾å®šå……è¶³æ€§** (æ•…äº‹æƒ…èŠ‚ã€äº’åŠ¨æ–¹å¼çš„ä¸°å¯Œæ€§å’Œæ•™è‚²æ€§)

è¯·ä»¥JSONæ ¼å¼è¿”å›è¯„ä¼°ç»“æœï¼š
{{
    "dimension_scores": {{
        "åŸºç¡€ä¿¡æ¯å……è¶³æ€§": [0-100åˆ†ï¼ŒåŸºäºå®é™…è¯„ä¼°],
        "æ•™å­¦ä¿¡æ¯å……è¶³æ€§": [0-100åˆ†ï¼ŒåŸºäºå®é™…è¯„ä¼°],
        "æ¸¸æˆè®¾å®šå……è¶³æ€§": [0-100åˆ†ï¼ŒåŸºäºå®é™…è¯„ä¼°],
        "æƒ…èŠ‚è®¾å®šå……è¶³æ€§": [0-100åˆ†ï¼ŒåŸºäºå®é™…è¯„ä¼°]
    }},
    "dimension_analysis": {{
        "åŸºç¡€ä¿¡æ¯å……è¶³æ€§": "[å…·ä½“åˆ†æåŸºç¡€ä¿¡æ¯çš„å……è¶³ç¨‹åº¦]",
        "æ•™å­¦ä¿¡æ¯å……è¶³æ€§": "[å…·ä½“åˆ†ææ•™å­¦ä¿¡æ¯çš„å……è¶³ç¨‹åº¦]",
        "æ¸¸æˆè®¾å®šå……è¶³æ€§": "[å…·ä½“åˆ†ææ¸¸æˆè®¾å®šçš„å……è¶³ç¨‹åº¦]",
        "æƒ…èŠ‚è®¾å®šå……è¶³æ€§": "[å…·ä½“åˆ†ææƒ…èŠ‚è®¾å®šçš„å……è¶³ç¨‹åº¦]"
    }},
    "overall_score": [4ä¸ªç»´åº¦åˆ†æ•°çš„å¹³å‡å€¼],
    "insufficient_areas": ["æƒ…èŠ‚å‘å±•ç»†èŠ‚", "äº’åŠ¨æœºåˆ¶è®¾è®¡"],
    "assessment_summary": "åŸºç¡€ä¿¡æ¯å®Œæ•´ï¼Œéœ€è¦è¡¥å……æƒ…èŠ‚å’Œäº’åŠ¨ç»†èŠ‚"
}}

è¯„åˆ†æ ‡å‡†ï¼š
- 90-100åˆ†ï¼šä¿¡æ¯éå¸¸è¯¦ç»†å®Œæ•´ï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆé«˜è´¨é‡å†…å®¹
- 75-89åˆ†ï¼šä¿¡æ¯åŸºæœ¬å……è¶³ï¼Œå¯èƒ½éœ€è¦å°‘é‡è¡¥å……
- 60-74åˆ†ï¼šä¿¡æ¯æœ‰ä¸€å®šåŸºç¡€ï¼Œä½†éœ€è¦é‡è¦è¡¥å……
- 60åˆ†ä»¥ä¸‹ï¼šä¿¡æ¯ä¸è¶³ï¼Œéœ€è¦å¤§é‡è¡¥å……

è¯·ç¡®ä¿è¿”å›æœ‰æ•ˆçš„JSONæ ¼å¼ã€‚"""
        
        return PromptTemplate(
            input_variables=["collected_info", "conversation_context"],
            template=template
        )
    
    def get_sufficiency_questions_prompt(self) -> PromptTemplate:
        """è·å–è¯¦ç»†åº¦è¡¥å……é—®é¢˜ç”Ÿæˆæ¨¡æ¿"""
        template = """ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²æ¸¸æˆè®¾è®¡åŠ©æ‰‹ã€‚æ ¹æ®ä»¥ä¸‹ä¿¡æ¯è¯„ä¼°ç»“æœï¼Œç”Ÿæˆé’ˆå¯¹æ€§çš„è¡¥å……é—®é¢˜æ¥å®Œå–„æ¸¸æˆè®¾è®¡ä¿¡æ¯ã€‚

å½“å‰æ”¶é›†ä¿¡æ¯ï¼š
{collected_info}

è¯¦ç»†åº¦è¯„ä¼°ç»“æœï¼š
{sufficiency_scores}
æ€»ä½“è¯„åˆ†ï¼š{overall_score}/100

å¯¹è¯ä¸Šä¸‹æ–‡ï¼š
{conversation_context}

è¯·æ ¹æ®è¯„ä¼°ç»“æœç”Ÿæˆ3-5ä¸ªå…·ä½“çš„è¡¥å……é—®é¢˜ï¼Œé‡ç‚¹å…³æ³¨è¯„åˆ†è¾ƒä½çš„ç»´åº¦ã€‚è¦æ±‚ï¼š

1. **é—®é¢˜åº”è¯¥å…·ä½“æ˜ç¡®**ï¼Œé¿å…æ¨¡ç³Šçš„å¼€æ”¾æ€§é—®é¢˜
2. **ä¼˜å…ˆå…³æ³¨è¯„åˆ†ä½äº75åˆ†çš„ç»´åº¦**
3. **ç»“åˆå¯¹è¯ä¸Šä¸‹æ–‡**ï¼Œé¿å…é‡å¤å·²ç»è®¨è®ºè¿‡çš„å†…å®¹
4. **å¾ªåºæ¸è¿›**ï¼Œä¸€æ¬¡ä¸è¦é—®å¤ªå¤šé—®é¢˜
5. **å‹å¥½è‡ªç„¶**ï¼Œä¿æŒå¯¹è¯çš„è¿è´¯æ€§

å›å¤æ ¼å¼ï¼š
é¦–å…ˆç®€è¦è¯´æ˜å½“å‰å®Œæˆåº¦å’Œéœ€è¦è¡¥å……çš„æ–¹é¢ï¼Œç„¶åæå‡ºå…·ä½“é—®é¢˜ã€‚

ç¤ºä¾‹å›å¤é£æ ¼ï¼š
"æ ¹æ®ç›®å‰çš„ä¿¡æ¯ï¼ŒåŸºç¡€è®¾å®šå·²ç»æ¯”è¾ƒå®Œæ•´äº†ï¼ä¸è¿‡ä¸ºäº†è®¾è®¡å‡ºæ›´ä¼˜è´¨çš„æ•™è‚²æ¸¸æˆï¼Œæˆ‘è¿˜éœ€è¦äº†è§£ä¸€äº›ç»†èŠ‚ï¼š

1. [å…·ä½“é—®é¢˜1]
2. [å…·ä½“é—®é¢˜2] 
3. [å…·ä½“é—®é¢˜3]

è¿™äº›ä¿¡æ¯å°†å¸®åŠ©æˆ‘ä¸ºæ‚¨ç”Ÿæˆæ›´ç²¾å‡†ã€æ›´æœ‰è¶£çš„æ¸¸æˆå†…å®¹ã€‚"

è¯·ç”Ÿæˆå›å¤ï¼š"""
        
        return PromptTemplate(
            input_variables=["collected_info", "sufficiency_scores", "overall_score", "conversation_context"],
            template=template
        )

    def get_input_fitness_check_prompt(self) -> PromptTemplate:
        """è·å–ç”¨æˆ·è¾“å…¥é€‚å®œæ€§æ£€æŸ¥æ¨¡æ¿"""
        template = """ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²å†…å®¹å®¡æŸ¥ä¸“å®¶ã€‚è¯·æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„æ•™è‚²æ¸¸æˆè®¾è®¡éœ€æ±‚æ˜¯å¦åˆç†å’Œé€‚å®œã€‚

ç”¨æˆ·è¾“å…¥ï¼š
{user_input}

å½“å‰æ”¶é›†çš„ä¿¡æ¯ï¼š
{collected_info}

è¯·ä»ä»¥ä¸‹ç»´åº¦æ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„é€‚å®œæ€§ï¼š

1. **é€»è¾‘åˆç†æ€§** - å­¦ç§‘å’ŒçŸ¥è¯†ç‚¹æ˜¯å¦åŒ¹é…ï¼ˆå¦‚ï¼šè¯­æ–‡è¯¾æ•™å››åˆ™è¿ç®—ã€è´Ÿä¸€å¹´çº§ã€é«˜ä¸‰å­¦å‰ç­å†…å®¹ç­‰ä¸åˆç†ç»„åˆï¼‰
2. **éš¾åº¦åˆç†æ€§** - çŸ¥è¯†ç‚¹éš¾åº¦æ˜¯å¦ä¸å¹´çº§æ°´å¹³åŒ¹é…ï¼ˆå¦‚ï¼šä¸€å¹´çº§å­¦å¾®ç§¯åˆ†ã€å¹¼å„¿å›­å­¦é«˜ç­‰æ•°å­¦ç­‰è¶…çº²å†…å®¹ï¼‰
3. **ä»·å€¼è§‚æ­£ç¡®æ€§** - æ•™å­¦ç›®æ ‡æ˜¯å¦ç§¯ææ­£é¢ï¼ˆæ‹’ç»å·çªƒã€æš´åŠ›ã€æ¬ºéª—ç­‰ä¸è‰¯å†…å®¹ï¼‰
4. **å¹´é¾„é€‚å®œæ€§** - å†…å®¹æ˜¯å¦é€‚åˆç›®æ ‡å¹´é¾„æ®µï¼ˆæ‹’ç»å°‘å„¿ä¸å®œã€ææ€–ã€è¡€è…¥å†…å®¹ï¼‰
5. **æ•™è‚²åˆè§„æ€§** - æ˜¯å¦ç¬¦åˆæ•™è‚²æ³•è§„å’Œé“å¾·æ ‡å‡†
6. **å¼•å¯¼æ€§æ£€æŸ¥** - æ˜¯å¦æœ‰æ¶æ„å¼•å¯¼æˆ–ä¸å½“æš—ç¤º

è¯·ä»¥JSONæ ¼å¼è¿”å›æ£€æŸ¥ç»“æœï¼š
{{
    "input_fitness": "[passedæˆ–rejectedï¼ŒåŸºäºè¯„ä¼°ç»“æœ]",
    "fitness_score": [0-100åˆ†ï¼ŒåŸºäºå®é™…è¯„ä¼°],
    "issues": [
        {{
            "category": "[é—®é¢˜ç±»åˆ«]",
            "severity": "[high/medium/low]",
            "description": "[å…·ä½“é—®é¢˜æè¿°]",
            "suggestion": "[æ”¹è¿›å»ºè®®]"
        }}
    ],
    "assessment_summary": "[è¾“å…¥å†…å®¹çš„æ•´ä½“è¯„ä¼°ç»“è®º]"
}}

æ£€æŸ¥æ ‡å‡†ï¼š
- input_fitness: "passed"(é€šè¿‡) æˆ– "rejected"(æ‹’ç»)
- high severity: ä¸¥é‡è¿åå¸¸è¯†æˆ–é“å¾·æ ‡å‡†ï¼Œå¿…é¡»æ‹’ç»
- medium severity: éœ€è¦ç”¨æˆ·æ¾„æ¸…æˆ–ä¿®æ”¹
- low severity: å»ºè®®æ€§æé†’

è¯·ä¸¥æ ¼æŒ‰ç…§JSONæ ¼å¼è¿”å›ç»“æœã€‚"""

        return PromptTemplate(
            input_variables=["user_input", "collected_info"],
            template=template
        )

    def get_fitness_check_prompt(self) -> PromptTemplate:
        """è·å–å†…å®¹é€‚å®œæ€§æ£€æŸ¥æ¨¡æ¿"""
        template = """ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²å†…å®¹å®¡æŸ¥ä¸“å®¶ã€‚è¯·æ£€æŸ¥ä»¥ä¸‹æ•™è‚²æ¸¸æˆè®¾è®¡éœ€æ±‚çš„é€‚å®œæ€§ï¼Œç¡®ä¿å†…å®¹é€‚åˆç›®æ ‡å¹´é¾„æ®µçš„å­¦ç”Ÿã€‚

    æ”¶é›†çš„ä¿¡æ¯ï¼š
    {collected_info}

    å¯¹è¯ä¸Šä¸‹æ–‡ï¼š
    {conversation_context}

    è¯·ä»ä»¥ä¸‹ç»´åº¦æ£€æŸ¥é€‚å®œæ€§ï¼š

    1. **å¹´é¾„é€‚å®œæ€§** - å†…å®¹æ˜¯å¦é€‚åˆç›®æ ‡å¹´çº§çš„å­¦ç”Ÿ
    2. **æ•™è‚²ä»·å€¼è§‚** - æ˜¯å¦ä¼ é€’æ­£ç¡®çš„æ•™è‚²ä»·å€¼è§‚
    3. **å†…å®¹å®‰å…¨æ€§** - æ˜¯å¦åŒ…å«ä¸å½“å†…å®¹ï¼ˆæš´åŠ›ã€ææ€–ã€æ­§è§†ç­‰ï¼‰
    4. **å¿ƒç†å¥åº·** - æ˜¯å¦ä¼šå¯¹å­¦ç”Ÿå¿ƒç†é€ æˆè´Ÿé¢å½±å“
    5. **æ–‡åŒ–æ•æ„Ÿæ€§** - æ˜¯å¦å°Šé‡ä¸åŒæ–‡åŒ–èƒŒæ™¯
    6. **å­¦ä¹ éš¾åº¦** - æ¸¸æˆéš¾åº¦æ˜¯å¦ä¸å¹´çº§æ°´å¹³åŒ¹é…

    è¯·ä»¥JSONæ ¼å¼è¿”å›æ£€æŸ¥ç»“æœï¼Œè¯·ç¡®ä¿æ‰€æœ‰å€¼éƒ½æ˜¯å…·ä½“å†…å®¹ï¼š
    {{
        "overall_fitness": "[passedæˆ–concernsï¼ŒåŸºäºè¯„ä¼°ç»“æœ]",
        "concerns": [
            {{
                "category": "[é—®é¢˜ç±»åˆ«]",
                "severity": "[high/medium/low]",
                "description": "[å…·ä½“é—®é¢˜æè¿°]",
                "suggestion": "[å…·ä½“æ”¹è¿›å»ºè®®]"
            }}
        ],
        "positive_aspects": ["[ç§¯ææ–¹é¢1]", "[ç§¯ææ–¹é¢2]"],
        "fitness_score": [0-100åˆ†ï¼ŒåŸºäºå®é™…è¯„ä¼°],
        "assessment_summary": "[æ•´ä½“é€‚å®œæ€§æ€»ç»“]"
    }}

    æ£€æŸ¥æ ‡å‡†ï¼š
    - high severity: ä¸¥é‡è¿åæ•™è‚²åŸåˆ™æˆ–å®‰å…¨æ ‡å‡†
    - medium severity: éœ€è¦è°ƒæ•´ä½†ä¸å½±å“æ•´ä½“é€‚å®œæ€§  
    - low severity: å»ºè®®æ€§æ”¹è¿›

    è¯·ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°JSONæ ¼å¼è¿”å›ï¼Œç¡®ä¿ï¼š
    1. overall_fitness å€¼ä¸º "passed" æˆ– "concerns" 
    2. fitness_score ä¸º0-100çš„æ•°å­—
    3. æ‰€æœ‰å­—ç¬¦ä¸²å€¼éƒ½å¡«å†™å…·ä½“å†…å®¹ï¼Œä¸ä½¿ç”¨å ä½ç¬¦ã€‚"""

        return PromptTemplate(
            input_variables=["collected_info", "conversation_context"],
            template=template
        )
    
    def get_negotiate_response_prompt(self) -> PromptTemplate:
        """è·å–é€‚å®œæ€§åå•†å›å¤æ¨¡æ¿"""
        template = """ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²æ¸¸æˆè®¾è®¡åŠ©æ‰‹ã€‚åœ¨å†…å®¹é€‚å®œæ€§æ£€æŸ¥ä¸­å‘ç°äº†ä¸€äº›éœ€è¦è®¨è®ºçš„é—®é¢˜ï¼Œè¯·ä»¥å‹å¥½ã€ä¸“ä¸šçš„æ–¹å¼ä¸ç”¨æˆ·åå•†è§£å†³æ–¹æ¡ˆã€‚

å½“å‰æ”¶é›†ä¿¡æ¯ï¼š
{collected_info}

é€‚å®œæ€§æ£€æŸ¥ç»“æœï¼š
æ€»ä½“è¯„ä¼°ï¼š{overall_fitness}
é€‚å®œæ€§è¯„åˆ†ï¼š{fitness_score}/100

å‘ç°çš„é—®é¢˜ï¼š
{concerns}

ç§¯ææ–¹é¢ï¼š
{positive_aspects}

å¯¹è¯ä¸Šä¸‹æ–‡ï¼š
{conversation_context}

è¯·ç”Ÿæˆä¸€ä¸ªå‹å¥½ã€å»ºè®¾æ€§çš„å›å¤ï¼Œè¦æ±‚ï¼š

1. **è‚¯å®šç§¯ææ–¹é¢** - å…ˆèµæ‰¬ç”¨æˆ·æä¾›çš„è‰¯å¥½æƒ³æ³•
2. **æ¸©å’Œæå‡ºé—®é¢˜** - ä»¥å»ºè®®çš„æ–¹å¼æå‡ºéœ€è¦è°ƒæ•´çš„åœ°æ–¹
3. **æä¾›è§£å†³æ–¹æ¡ˆ** - ç»™å‡ºå…·ä½“çš„æ”¹è¿›å»ºè®®
4. **ä¿æŒåˆä½œæ€åº¦** - å¼ºè°ƒæ˜¯ä¸ºäº†åˆ›é€ æ›´å¥½çš„æ•™è‚²ä½“éªŒ
5. **é‚€è¯·è®¨è®º** - è¯¢é—®ç”¨æˆ·çš„æƒ³æ³•å’Œåå¥½

å›å¤åº”è¯¥ç±»ä¼¼è¿™æ ·çš„é£æ ¼ï¼š
"æ‚¨çš„æ¸¸æˆåˆ›æ„å¾ˆæ£’ï¼ç‰¹åˆ«æ˜¯[ç§¯ææ–¹é¢]ã€‚ä¸ºäº†ç¡®ä¿æ¸¸æˆæ›´é€‚åˆç›®æ ‡å¹´é¾„æ®µçš„å­¦ç”Ÿï¼Œæˆ‘å»ºè®®æˆ‘ä»¬åœ¨å‡ ä¸ªæ–¹é¢ç¨ä½œè°ƒæ•´ï¼š

[å…·ä½“å»ºè®®å’ŒåŸå› ]

æ‚¨è§‰å¾—è¿™æ ·çš„è°ƒæ•´å¦‚ä½•ï¼Ÿæˆ–è€…æ‚¨æœ‰å…¶ä»–æƒ³æ³•å—ï¼Ÿ"

è¯·ç”Ÿæˆå›å¤ï¼š"""
        
        return PromptTemplate(
            input_variables=["collected_info", "overall_fitness", "fitness_score", "concerns", "positive_aspects", "conversation_context"],
            template=template
        )
    
    def get_finish_response_prompt(self) -> PromptTemplate:
        """è·å–å®Œæˆç¡®è®¤å›å¤æ¨¡æ¿"""
        template = """ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²æ¸¸æˆè®¾è®¡åŠ©æ‰‹ã€‚ç»è¿‡è¯¦ç»†çš„ä¿¡æ¯æ”¶é›†å’Œè¯„ä¼°ï¼Œç°åœ¨å‡†å¤‡ä¸ºç”¨æˆ·ç”Ÿæˆå®Œæ•´çš„æ•™è‚²æ¸¸æˆå†…å®¹ã€‚è¯·ç”Ÿæˆä¸€ä¸ªä¸“ä¸šã€ä»¤äººå…´å¥‹çš„å®Œæˆç¡®è®¤å›å¤ã€‚

æœ€ç»ˆæ”¶é›†ä¿¡æ¯ï¼š
{collected_info}

è¯¦ç»†åº¦è¯„ä¼°ç»“æœï¼š
{sufficiency_scores}
å¹³å‡è¯„åˆ†ï¼š{average_score}/100

å¯¹è¯å†ç¨‹ï¼š
{conversation_context}

è¯·ç”Ÿæˆä¸€ä¸ªä¸“ä¸šè€Œä»¤äººå…´å¥‹çš„å®Œæˆå›å¤ï¼ŒåŒ…å«ï¼š

1. **åº†ç¥å®Œæˆ** - ç¥è´ºç”¨æˆ·å®Œæˆè¯¦ç»†çš„éœ€æ±‚æ”¶é›†è¿‡ç¨‹
2. **æ€»ç»“æ”¶é›†æˆæœ** - ç®€è¦æ€»ç»“æ”¶é›†åˆ°çš„å…³é”®ä¿¡æ¯
3. **ç¡®è®¤ç†è§£** - ç¡®è®¤å¯¹ç”¨æˆ·éœ€æ±‚çš„ç†è§£æ˜¯å¦å‡†ç¡®
4. **é¢„å‘Šç”Ÿæˆå†…å®¹** - è¯´æ˜å°†è¦ç”Ÿæˆä»€ä¹ˆæ ·çš„æ¸¸æˆå†…å®¹
5. **ä¸‹ä¸€æ­¥æŒ‡å¼•** - å‘ŠçŸ¥ç”¨æˆ·å¦‚ä½•è¿›è¡Œä¸‹ä¸€æ­¥

å›å¤åº”è¯¥ä¸“ä¸šä¸”å……æ»¡æœŸå¾…ï¼Œç±»ä¼¼ï¼š
"ğŸ‰ å¤ªæ£’äº†ï¼ç»è¿‡æˆ‘ä»¬çš„è¯¦ç»†äº¤æµï¼Œæ•™è‚²æ¸¸æˆçš„éœ€æ±‚æ”¶é›†å·²ç»å®Œæˆï¼

è®©æˆ‘æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬æ”¶é›†åˆ°çš„ä¿¡æ¯ï¼š
[å…³é”®ä¿¡æ¯æ€»ç»“]

åŸºäºè¿™äº›ä¿¡æ¯ï¼Œæˆ‘å°†ä¸ºæ‚¨ç”Ÿæˆï¼š
â€¢ å®Œæ•´çš„æ¸¸æˆæ•…äº‹æ¡†æ¶å’Œå‰§æƒ…è®¾è®¡
â€¢ æ¯ä¸ªå…³å¡çš„è¯¦ç»†åœºæ™¯å’Œä»»åŠ¡è®¾ç½®  
â€¢ è§’è‰²å¯¹è¯å’Œäº’åŠ¨å†…å®¹
â€¢ æ•™è‚²ç›®æ ‡çš„å·§å¦™èå…¥æ–¹å¼

è¯·ç¡®è®¤ä»¥ä¸Šç†è§£æ˜¯å¦å‡†ç¡®ï¼Ÿå¦‚æœæ²¡æœ‰é—®é¢˜ï¼Œæˆ‘å°±å¼€å§‹ä¸ºæ‚¨ç”Ÿæˆå®Œæ•´çš„æ•™è‚²æ¸¸æˆå†…å®¹ï¼"

è¯·ç”Ÿæˆå›å¤ï¼š"""
        
        return PromptTemplate(
            input_variables=["collected_info", "sufficiency_scores", "average_score", "conversation_context"],
            template=template
        )
    
    def get_requirement_analysis_prompt(self) -> PromptTemplate:
        """è·å–RPGæ•™è‚²æ¸¸æˆéœ€æ±‚åˆ†ææŠ¥å‘Šæ¨¡æ¿"""
        template = """ä½ æ˜¯ä¸“ä¸šçš„RPGæ•™è‚²æ¸¸æˆè®¾è®¡åˆ†æå¸ˆã€‚è¯·åŸºäºæ”¶é›†çš„éœ€æ±‚ä¿¡æ¯ç”Ÿæˆä¸€ä»½é¢å‘RPGæ•…äº‹æ¡†æ¶è®¾è®¡çš„éœ€æ±‚åˆ†ææŠ¥å‘Šã€‚

æ”¶é›†çš„éœ€æ±‚ä¿¡æ¯ï¼š
{collected_info}

è´¨é‡è¯„ä¼°ç»“æœï¼š
{sufficiency_scores}
å¹³å‡è¯„åˆ†ï¼š{average_score}/100

è¯·ç”Ÿæˆä¸“ä¸šçš„RPGæ•™è‚²æ¸¸æˆéœ€æ±‚åˆ†ææŠ¥å‘Šï¼Œé‡ç‚¹æå–ä»¥ä¸‹RPGè®¾è®¡æ ¸å¿ƒå…ƒç´ ï¼š

**ã€é¡¹ç›®åŸºç¡€ä¿¡æ¯ã€‘**
- ç›®æ ‡å­¦ç§‘ã€å¹´çº§ã€çŸ¥è¯†ç‚¹
- æ•™å­¦ç›®æ ‡å’Œå­¦ä¹ éš¾ç‚¹

**ã€RPGä¸–ç•Œè§‚è®¾è®¡è¦ç´ ã€‘**
- æ¸¸æˆä¸–ç•ŒèƒŒæ™¯å’Œè®¾å®š
- ä¸»è¦è§’è‰²å’ŒNPCè®¾è®¡
- ä¸–ç•Œè§‚ä¸æ•™è‚²å†…å®¹çš„ç»“åˆç‚¹

**ã€RPGæ•…äº‹ç»“æ„è¦ç´ ã€‘**
- ä¸»çº¿å‰§æƒ…æ¡†æ¶
- æ•™è‚²å†…å®¹å¦‚ä½•èå…¥æ•…äº‹çº¿
- å…³é”®æ•…äº‹èŠ‚ç‚¹å’Œæ•™å­¦æ£€æŸ¥ç‚¹

**ã€RPGæ¸¸æˆæœºåˆ¶è¦ç´ ã€‘**
- æ ¸å¿ƒäº’åŠ¨æœºåˆ¶
- è¿›åº¦ç³»ç»Ÿå’Œå¥–åŠ±æœºåˆ¶
- æ•™è‚²è¯„ä¼°çš„æ¸¸æˆåŒ–å®ç°

**ã€æ•™è‚²-RPGèåˆåˆ†æã€‘**
- æ•™å­¦ç›®æ ‡ä¸RPGå…ƒç´ çš„åŒ¹é…åº¦
- çŸ¥è¯†ç‚¹åœ¨æ•…äº‹ä¸­çš„åˆ†å¸ƒç­–ç•¥
- å­¦ä¹ éš¾ç‚¹çš„æ¸¸æˆåŒ–è§£å†³æ–¹æ¡ˆ

**ã€ç¬¬äºŒé˜¶æ®µè®¾è®¡æŒ‡å¯¼ã€‘**
- RPGæ•…äº‹æ¡†æ¶çš„å…³é”®è®¾è®¡ç‚¹
- å†…å®¹æ‹“å±•çš„é‡ç‚¹æ–¹å‘
- æŠ€æœ¯å®ç°çš„æ ¸å¿ƒéœ€æ±‚

è¦æ±‚ï¼š
- é‡ç‚¹çªå‡ºRPGè®¾è®¡è¦ç´ 
- ä¸ºæ•…äº‹æ¡†æ¶ç”Ÿæˆæä¾›å…·ä½“æŒ‡å¯¼
- ç¡®ä¿æ‰€æœ‰åŸºç¡€ä¿¡æ¯å®Œæ•´åŒ…å«
- æ ¼å¼æ¸…æ™°ï¼Œä¾¿äºç¬¬äºŒé˜¶æ®µç³»ç»Ÿä½¿ç”¨

è¯·ä»¥ç»“æ„åŒ–æ–‡æœ¬æŠ¥å‘Šæ ¼å¼è¾“å‡ºã€‚"""

        return PromptTemplate(
            input_variables=["collected_info", "sufficiency_scores", "average_score"],
            template=template
        )
    
    def get_story_framework_generation_prompt(self) -> PromptTemplate:
        """è·å–RPGæ•…äº‹æ¡†æ¶ç”Ÿæˆæ¨¡æ¿"""
        template = """ä½ æ˜¯ä¸“ä¸šçš„RPGæ•™è‚²æ¸¸æˆæ•…äº‹è®¾è®¡å¸ˆã€‚è¯·åŸºäºéœ€æ±‚ä¿¡æ¯ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„6å…³å¡RPGæ•…äº‹æ¡†æ¶ã€‚

éœ€æ±‚ä¿¡æ¯ï¼š
{collected_info}

è´¨é‡è¯„ä¼°ï¼š
{sufficiency_scores}
å¹³å‡è¯„åˆ†ï¼š{average_score}/100

è¯·ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„RPGæ•™è‚²æ¸¸æˆæ•…äº‹æ¡†æ¶ï¼Œå¿…é¡»åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

## ã€æ•…äº‹ä¸»çº¿è®¾è®¡ã€‘
è¯·è®¾è®¡ä¸€ä¸ªå¼•äººå…¥èƒœçš„ä¸»çº¿æ•…äº‹ï¼ŒåŒ…å«ï¼š
- **ä¸»è§’èƒŒæ™¯**ï¼šä¸»è§’çš„èº«ä»½ã€åŠ¨æœºã€ç‰¹æ®Šèƒ½åŠ›
- **ä¸–ç•Œè§‚è®¾å®š**ï¼šæ¸¸æˆä¸–ç•Œçš„èƒŒæ™¯ã€è§„åˆ™ã€ç‰¹è‰²
- **æ ¸å¿ƒå†²çª**ï¼šä¸»è¦çŸ›ç›¾å’ŒæŒ‘æˆ˜ï¼ˆä¸æ•™å­¦ç›®æ ‡ç›¸å…³ï¼‰
- **æ•…äº‹ç›®æ ‡**ï¼šä¸»è§’çš„ç»ˆæç›®æ ‡å’Œæˆé•¿è½¨è¿¹
- **ä¸»çº¿å‰§æƒ…**ï¼šå®Œæ•´çš„æ•…äº‹å‘å±•è„‰ç»œï¼ˆèµ·æ‰¿è½¬åˆï¼‰

## ã€6å…³å¡è¯¦ç»†è®¾è®¡ã€‘
ä¸ºæ¯ä¸ªå…³å¡è®¾è®¡è¯¦ç»†å†…å®¹ï¼š

**å…³å¡1ï¼š[å…³å¡åç§°]**
- åœºæ™¯è®¾å®šï¼š
  * ç¯å¢ƒæ¦‚è¿°ï¼šè¯¦ç»†æè¿°å…³å¡çš„ç¯å¢ƒæ°›å›´å’Œè§†è§‰ç‰¹è‰²
  * æ ¸å¿ƒåœºæ™¯ï¼šå…³å¡ä¸­çš„å…³é”®åœºæ™¯å’Œä¸»è¦ç‰©å“/è§’è‰²
  * æ°›å›´å®šè°ƒï¼šè¥é€ çš„æƒ…æ„Ÿæ°›å›´å’Œæ¢ç´¢æ„Ÿå—
- å‰§æƒ…æè¿°ï¼šå…·ä½“çš„æ•…äº‹æƒ…èŠ‚å’Œåœºæ™¯
- æ•™å­¦èå…¥ï¼šå¦‚ä½•è‡ªç„¶èå…¥çŸ¥è¯†ç‚¹"{knowledge_points}"
- è€ƒæ ¸è®¾è®¡ï¼šä¸»è¦è€ƒæ ¸ç‚¹å’Œè¯„ä¼°æ–¹å¼
- äº’åŠ¨æ–¹å¼ï¼šæ¸¸æˆåŒ–çš„å­¦ä¹ äº’åŠ¨
- ä¸»çº¿è¡”æ¥ï¼šä¸æ€»ä½“æ•…äº‹çš„å…³ç³»

**å…³å¡2-6ï¼š[ä¾æ­¤ç±»æ¨]**
æ¯ä¸ªå…³å¡éƒ½éœ€è¦åŒ…å«ç›¸åŒçš„åœºæ™¯è®¾å®šæ ¼å¼ï¼ŒåŒ…æ‹¬ç¯å¢ƒæ¦‚è¿°ã€æ ¸å¿ƒåœºæ™¯ã€æ°›å›´å®šè°ƒç­‰è¦ç´ ã€‚

### åœºæ™¯æè¿°ç¤ºä¾‹å‚è€ƒï¼š
å…³å¡ç¤ºä¾‹ï¼š[ç¥ç§˜æ£®æ—]
- åœºæ™¯è®¾å®šï¼š
  * ç¯å¢ƒæ¦‚è¿°ï¼šå¤è€èŒ‚å¯†çš„é­”æ³•æ£®æ—ï¼Œé˜³å…‰é€è¿‡æ ‘å¶æ´’ä¸‹æ–‘é©³å…‰å½±
  * æ ¸å¿ƒåœºæ™¯ï¼šè¢«æ•°å­—ç¬¦å·è£…é¥°çš„ç¥ç§˜ç¬¼å­å›°ä½å°å…”å­  
  * æ°›å›´å®šè°ƒï¼šæ¸©é¦¨è€Œç¥ç§˜ï¼Œå……æ»¡æ¢ç´¢æ„Ÿ

è¯·ä¸ºæ¯ä¸ªå…³å¡åˆ›å»ºç±»ä¼¼é£æ ¼ä½†å†…å®¹ä¸åŒçš„åœºæ™¯è®¾å®šï¼Œç¡®ä¿ï¼š
1. ç¯å¢ƒæè¿°ç”ŸåŠ¨å½¢è±¡ï¼Œç¬¦åˆå¹´çº§å­¦ç”Ÿçš„æƒ³è±¡åŠ›
2. æ ¸å¿ƒåœºæ™¯ä¸æ•™å­¦å†…å®¹è‡ªç„¶ç»“åˆ
3. æ°›å›´è¥é€ æœ‰åˆ©äºå­¦ä¹ æŠ•å…¥å’Œæƒ…æ„Ÿä»£å…¥

## ã€è¿è´¯æ€§ä¿è¯ã€‘
- **æƒ…èŠ‚è¡”æ¥**ï¼šå„å…³å¡é—´çš„é€»è¾‘è¿‡æ¸¡
- **è§’è‰²å‘å±•**ï¼šä¸»è§’åœ¨å„å…³å¡çš„æˆé•¿å˜åŒ–
- **çŸ¥è¯†é€’è¿›**ï¼šçŸ¥è¯†ç‚¹çš„å¾ªåºæ¸è¿›å®‰æ’
- **å¥–åŠ±ç³»ç»Ÿ**ï¼šè´¯ç©¿å§‹ç»ˆçš„æ¿€åŠ±æœºåˆ¶

## ã€æ•™è‚²æ¸¸æˆåŒ–è®¾è®¡ã€‘
- **å­¦ä¸­ç©**ï¼šå¦‚ä½•è®©å­¦ä¹ è¿‡ç¨‹å……æ»¡è¶£å‘³
- **æƒ…æ™¯ä»£å…¥**ï¼šè®©å­¦ç”Ÿæ²‰æµ¸åœ¨æ•…äº‹ä¸–ç•Œä¸­
- **æˆå°±æ„Ÿ**ï¼šé€šè¿‡æ¸¸æˆæœºåˆ¶å¢å¼ºå­¦ä¹ æˆå°±æ„Ÿ

è¦æ±‚ï¼š
1. æ•…äº‹å¿…é¡»ç¬¦åˆ"{grade}"å­¦ç”Ÿçš„è®¤çŸ¥æ°´å¹³å’Œå…´è¶£
2. çŸ¥è¯†ç‚¹èå…¥è¦è‡ªç„¶ï¼Œé¿å…ç”Ÿç¡¬çš„"åšé¢˜"æ„Ÿè§‰
3. æ¯ä¸ªå…³å¡éƒ½è¦æœ‰æ˜ç¡®çš„æ•™å­¦ç›®æ ‡å’Œè€ƒæ ¸ç‚¹
4. æ•…äº‹æƒ…èŠ‚è¦è¿è´¯æµç•…ï¼Œå¸å¼•å­¦ç”ŸæŒç»­å‚ä¸
5. ç¬¦åˆ"{game_style}"é£æ ¼å’Œ"{world_setting}"è®¾å®š
6. ä¸»è§’å¯ä»¥æ˜¯"{character_design}"ç±»å‹

è¯·ä»¥ç»“æ„åŒ–æ ¼å¼è¾“å‡ºå®Œæ•´çš„æ•…äº‹æ¡†æ¶è®¾è®¡ã€‚"""

        return PromptTemplate(
            input_variables=["collected_info", "sufficiency_scores", "average_score", "knowledge_points", "grade", "game_style", "world_setting", "character_design", "analysis_report"],
            template=template
        )

    def get_story_review_prompt(self) -> PromptTemplate:
        """è·å–æ•…äº‹æ¡†æ¶å®¡æ ¸è¯„åˆ†æ¨¡æ¿"""
        template = """ä½ æ˜¯ä¸“ä¸šçš„æ•™è‚²æ¸¸æˆè´¨é‡è¯„ä¼°ä¸“å®¶ã€‚è¯·å¯¹ä»¥ä¸‹RPGæ•…äº‹æ¡†æ¶è¿›è¡Œå…¨é¢è¯„ä¼°æ‰“åˆ†ã€‚

åŸå§‹éœ€æ±‚ï¼š
{collected_info}

ç”Ÿæˆçš„æ•…äº‹æ¡†æ¶ï¼š
{story_framework}

è¯·ä»ä»¥ä¸‹6ä¸ªç»´åº¦è¿›è¡Œè¯„åˆ†ï¼ˆæ¯é¡¹0-100åˆ†ï¼‰ï¼š

## ã€è¯„åˆ†ç»´åº¦ã€‘

**1. ä¸»çº¿æ˜ç¡®æ€§è¯„åˆ† (0-100åˆ†)**
è¯„ä¼°æ ‡å‡†ï¼š
- æ•…äº‹ç›®æ ‡æ˜¯å¦æ¸…æ™°æ˜ç¡®
- ä¸»è§’åŠ¨æœºæ˜¯å¦åˆç†å……åˆ†
- æ ¸å¿ƒå†²çªè®¾ç½®æ˜¯å¦æœ‰å¸å¼•åŠ›
- æ•™å­¦ç›®æ ‡ä¸æ•…äº‹èåˆåº¦
- æ•´ä½“æ•…äº‹å¼§çº¿æ˜¯å¦å®Œæ•´

**2. å†…å®¹ä¸€è‡´æ€§è¯„åˆ† (0-100åˆ†)**
è¯„ä¼°æ ‡å‡†ï¼š
- ä¸ç”¨æˆ·éœ€æ±‚çš„åŒ¹é…ç¨‹åº¦
- å­¦ç§‘ã€å¹´çº§ã€çŸ¥è¯†ç‚¹çš„å‡†ç¡®å¯¹åº”
- æ¸¸æˆé£æ ¼ã€è§’è‰²ã€ä¸–ç•Œè§‚çš„ä¸€è‡´æ€§
- æ•™å­¦éš¾ç‚¹çš„åˆç†ä½“ç°
- äº’åŠ¨éœ€æ±‚çš„å‡†ç¡®å®ç°

**3. å‰§æƒ…è¿è´¯æ€§è¯„åˆ† (0-100åˆ†)**
è¯„ä¼°æ ‡å‡†ï¼š
- 6ä¸ªå…³å¡é—´çš„é€»è¾‘è¡”æ¥
- æ•…äº‹æƒ…èŠ‚å‘å±•çš„æµç•…æ€§
- è§’è‰²æˆé•¿è½¨è¿¹çš„åˆç†æ€§
- æƒ…èŠ‚è¿‡æ¸¡çš„è‡ªç„¶æ€§
- æ•´ä½“å™äº‹çš„å®Œæ•´æ€§

**4. æ•™è‚²èåˆåº¦è¯„åˆ† (0-100åˆ†)**
è¯„ä¼°æ ‡å‡†ï¼š
- çŸ¥è¯†ç‚¹èå…¥çš„è‡ªç„¶ç¨‹åº¦
- è€ƒæ ¸æ–¹å¼çš„åˆ›æ–°æ€§å’Œåˆç†æ€§
- äº’åŠ¨è®¾è®¡ä¸æ•™å­¦ç›®æ ‡çš„åŒ¹é…
- é¿å…ç”Ÿç¡¬"åšé¢˜"çš„ç¨‹åº¦
- æ•™å­¦éš¾ç‚¹çš„æœ‰æ•ˆè§£å†³æ–¹æ¡ˆ

**5. å¸å¼•åŠ›è¯„ä¼°è¯„åˆ† (0-100åˆ†)**
è¯„ä¼°æ ‡å‡†ï¼š
- æ•…äº‹çš„è¶£å‘³æ€§å’Œå¸å¼•åŠ›
- æ¸¸æˆåŒ–è®¾è®¡çš„ä¸°å¯Œç¨‹åº¦
- æ²‰æµ¸æ„Ÿä½“éªŒçš„è¥é€ 
- "ç©ä¸­å­¦"ç†å¿µçš„ä½“ç°
- å¯¹ç›®æ ‡å¹´é¾„æ®µçš„é€‚å®œæ€§

**6. åœºæ™¯å‰§æœ¬è´´åˆåº¦è¯„åˆ† (0-100åˆ†)**
è¯„ä¼°æ ‡å‡†ï¼š
- åœºæ™¯è®¾å®šçš„å®Œæ•´æ€§å’Œç”ŸåŠ¨æ€§ï¼ˆç¯å¢ƒæ¦‚è¿°ã€æ ¸å¿ƒåœºæ™¯ã€æ°›å›´å®šè°ƒï¼‰
- åœºæ™¯ä¸å‰§æƒ…çš„è‡ªç„¶èåˆåº¦
- ç¯å¢ƒæè¿°ä¸æ•™å­¦å†…å®¹çš„åŒ¹é…ç¨‹åº¦
- è§†è§‰åœºæ™¯çš„æƒ³è±¡åŠ›æ¿€å‘æ•ˆæœ
- åœºæ™¯æ°›å›´ä¸å­¦ä¹ ç›®æ ‡çš„åè°ƒæ€§
- å„å…³å¡åœºæ™¯é—´çš„é£æ ¼ä¸€è‡´æ€§å’Œå˜åŒ–åˆç†æ€§

## ã€è¯„åˆ†è¦æ±‚ã€‘
- æ¯ä¸ªç»´åº¦ç»™å‡ºå…·ä½“åˆ†æ•°å’Œè¯¦ç»†ç†ç”±
- æŒ‡å‡ºå…·ä½“çš„ä¼˜ç‚¹å’Œä¸è¶³
- æä¾›é’ˆå¯¹æ€§çš„æ”¹è¿›å»ºè®®
- æ€»åˆ†ä¸º6ä¸ªç»´åº¦çš„å¹³å‡åˆ†

## ã€é€šè¿‡æ ‡å‡†ã€‘
- å„å•é¡¹ç»´åº¦â‰¥75åˆ†
- æ€»åˆ†â‰¥80åˆ†ï¼ˆ6ä¸ªç»´åº¦çš„å¹³å‡åˆ†ï¼‰
- å¦‚æœªè¾¾æ ‡ï¼Œéœ€é‡æ–°ç”Ÿæˆ

è¯·ä»¥JSONæ ¼å¼è¿”å›è¯„åˆ†ç»“æœï¼š
{{
    "ä¸»çº¿æ˜ç¡®æ€§": {{
        "åˆ†æ•°": [æ ¹æ®å®é™…è¯„ä¼°ç»™å‡º0-100çš„åˆ†æ•°],
        "è¯„ä»·": "[è¯¦ç»†åˆ†æè¯¥ç»´åº¦çš„è¡¨ç°]",
        "æ”¹è¿›å»ºè®®": "[é’ˆå¯¹æ€§çš„æ”¹è¿›å»ºè®®]"
    }},
    "å†…å®¹ä¸€è‡´æ€§": {{
        "åˆ†æ•°": [æ ¹æ®å®é™…è¯„ä¼°ç»™å‡º0-100çš„åˆ†æ•°],
        "è¯„ä»·": "[è¯¦ç»†åˆ†æè¯¥ç»´åº¦çš„è¡¨ç°]",
        "æ”¹è¿›å»ºè®®": "[é’ˆå¯¹æ€§çš„æ”¹è¿›å»ºè®®]"
    }},
    "å‰§æƒ…è¿è´¯æ€§": {{
        "åˆ†æ•°": [æ ¹æ®å®é™…è¯„ä¼°ç»™å‡º0-100çš„åˆ†æ•°],
        "è¯„ä»·": "[è¯¦ç»†åˆ†æè¯¥ç»´åº¦çš„è¡¨ç°]", 
        "æ”¹è¿›å»ºè®®": "[é’ˆå¯¹æ€§çš„æ”¹è¿›å»ºè®®]"
    }},
    "æ•™è‚²èåˆåº¦": {{
        "åˆ†æ•°": [æ ¹æ®å®é™…è¯„ä¼°ç»™å‡º0-100çš„åˆ†æ•°],
        "è¯„ä»·": "[è¯¦ç»†åˆ†æè¯¥ç»´åº¦çš„è¡¨ç°]",
        "æ”¹è¿›å»ºè®®": "[é’ˆå¯¹æ€§çš„æ”¹è¿›å»ºè®®]"
    }},
    "å¸å¼•åŠ›è¯„ä¼°": {{
        "åˆ†æ•°": [æ ¹æ®å®é™…è¯„ä¼°ç»™å‡º0-100çš„åˆ†æ•°],
        "è¯„ä»·": "[è¯¦ç»†åˆ†æè¯¥ç»´åº¦çš„è¡¨ç°]",
        "æ”¹è¿›å»ºè®®": "[é’ˆå¯¹æ€§çš„æ”¹è¿›å»ºè®®]"
    }},
    "åœºæ™¯å‰§æœ¬è´´åˆåº¦": {{
        "åˆ†æ•°": [æ ¹æ®å®é™…è¯„ä¼°ç»™å‡º0-100çš„åˆ†æ•°],
        "è¯„ä»·": "[è¯¦ç»†åˆ†æåœºæ™¯è®¾å®šçš„å®Œæ•´æ€§ã€åœºæ™¯ä¸å‰§æƒ…èåˆåº¦ã€ç¯å¢ƒæè¿°æ•ˆæœç­‰]",
        "æ”¹è¿›å»ºè®®": "[é’ˆå¯¹åœºæ™¯æè¿°ã€æ°›å›´è¥é€ ã€è§†è§‰æ•ˆæœçš„å…·ä½“æ”¹è¿›å»ºè®®]"
    }},
    "æ€»åˆ†": [6ä¸ªç»´åº¦åˆ†æ•°çš„å¹³å‡å€¼],
    "æ•´ä½“è¯„ä»·": "[ç»¼åˆè¯„ä»·æ•…äº‹æ¡†æ¶çš„æ•´ä½“è´¨é‡]",
    "æ˜¯å¦é€šè¿‡": [true/falseï¼ŒåŸºäºé€šè¿‡æ ‡å‡†åˆ¤æ–­],
    "é‡ç‚¹æ”¹è¿›æ–¹å‘": ["[å…·ä½“æ”¹è¿›ç‚¹1]", "[å…·ä½“æ”¹è¿›ç‚¹2]"]
}}

é‡è¦æé†’ï¼šè¯·æ ¹æ®æ•…äº‹æ¡†æ¶çš„å®é™…è´¨é‡è¿›è¡Œå®¢è§‚è¯„åˆ†ï¼Œä¸è¦ä½¿ç”¨ç¤ºä¾‹ä¸­çš„æ•°å­—ï¼"""

        return PromptTemplate(
            input_variables=["collected_info", "story_framework"],
            template=template
        )

    def get_story_improvement_prompt(self) -> PromptTemplate:
        """è·å–æ•…äº‹æ”¹è¿›æŒ‡å¯¼æ¨¡æ¿"""
        template = """åŸºäºä¸“å®¶è¯„å®¡åé¦ˆï¼Œè¯·æ”¹è¿›RPGæ•…äº‹æ¡†æ¶è®¾è®¡ã€‚

åŸå§‹éœ€æ±‚ï¼š
{collected_info}

å½“å‰æ•…äº‹æ¡†æ¶ï¼š
{current_framework}

è¯„å®¡åé¦ˆï¼š
{review_feedback}

é‡ç‚¹æ”¹è¿›æ–¹å‘ï¼š
{improvement_focus}

è¯·æ ¹æ®è¯„å®¡æ„è§ï¼Œé‡æ–°è®¾è®¡æ•…äº‹æ¡†æ¶ï¼Œé‡ç‚¹æ”¹è¿›ä»¥ä¸‹æ–¹é¢ï¼š
{specific_improvements}

æ”¹è¿›è¦æ±‚ï¼š
1. ä¿æŒå·²æœ‰çš„ä¼˜ç‚¹å’Œé«˜åˆ†éƒ¨åˆ†
2. é’ˆå¯¹æ€§è§£å†³è¯„åˆ†ä½çš„é—®é¢˜
3. ç¡®ä¿æ”¹è¿›åçš„è®¾è®¡æ›´åŠ ä¼˜ç§€
4. ç»´æŒæ•´ä½“æ•…äº‹çš„å®Œæ•´æ€§å’Œå¸å¼•åŠ›

è¯·è¾“å‡ºæ”¹è¿›åçš„å®Œæ•´æ•…äº‹æ¡†æ¶ã€‚"""

        return PromptTemplate(
            input_variables=["collected_info", "current_framework", "review_feedback", "improvement_focus", "specific_improvements"],
            template=template
        )

    def get_level_characters_generation_prompt(self) -> PromptTemplate:
        """è·å–å…³å¡è§’è‰²å¯¹è¯ç”Ÿæˆæ¨¡æ¿"""
        # å®Œæ•´çš„å¯¹è¯ç”ŸæˆPrompt

        template = """ã€ä»»åŠ¡ã€‘ï¼šåŸºäºStory Frameworkçš„å®Œæ•´è®¾è®¡æ¡†æ¶ï¼Œç»“åˆScene Dataçš„åœºæ™¯å‰§æœ¬ï¼Œç”Ÿæˆç¬¦åˆå…³å¡èŠ‚å¥çš„è§’è‰²å¯¹è¯è„šæœ¬

        Story Frameworkå†…å®¹ï¼š
        {story_framework}

        Scene Dataå†…å®¹ï¼š
        {scene_data}

        å½“å‰å…³å¡ï¼šç¬¬{level}å…³å¡

        è¯·ä»¥Story Frameworkä¸ºä¸»è¦ä¾æ®ï¼ˆåŒ…å«æ•™å­¦ç›®æ ‡ã€äº’åŠ¨æ–¹å¼ã€æƒ…èŠ‚æ•…äº‹çº¿ã€è§’è‰²è®¾å®šç­‰å®Œæ•´ä¿¡æ¯ï¼‰ï¼Œç»“åˆScene Dataæä¾›çš„åœºæ™¯æè¿°å’Œå‰§æœ¬å†…å®¹ï¼Œç”Ÿæˆå®Œæ•´çš„è§’è‰²å¯¹è¯è„šæœ¬ã€‚

        ã€èŠ‚å¥ç±»å‹å¯¹è¯ç‰¹ç‚¹ã€‘

        **ğŸ”¥ ç´§å¼ å‹å…³å¡**
        - å¯¹è¯è½®æ¬¡ï¼š6-10è½®ï¼ˆå¿«èŠ‚å¥ï¼Œç›´å¥”ä¸»é¢˜ï¼‰
        - æƒ…ç»ªçŠ¶æ€ï¼šç´§è¿«ã€æ‹…å¿§ã€ä¸“æ³¨ã€è‚¾ä¸Šè…ºç´ 
        - å¯¹è¯ç‰¹ç‚¹ï¼šè¯­é€Ÿå¿«ã€å¥å­çŸ­ã€å¤šæ„Ÿå¹å¥ã€å†³æ–­æ€§å¼ºã€å°‘åºŸè¯
        - çŸ¥è¯†èå…¥ï¼šç”Ÿå­˜å…³é”®ã€ç²¾ç¡®è®¡ç®—ã€å…³é”®æ—¶åˆ»ã€é”™è¯¯æœ‰åæœ

        **ğŸ” æ¢ç´¢å‹å…³å¡**
        - å¯¹è¯è½®æ¬¡ï¼š8-12è½®ï¼ˆä¸­ç­‰èŠ‚å¥ï¼Œé€æ­¥å±•å¼€ï¼‰
        - æƒ…ç»ªçŠ¶æ€ï¼šå¥½å¥‡ã€è°¨æ…ã€å…´å¥‹å‘ç°ã€é€æ­¥ç†è§£
        - å¯¹è¯ç‰¹ç‚¹ï¼šæè¿°æ€§å¼ºã€é€æ­¥æ­ç¤ºã€å¯å‘æ€è€ƒã€è§‚å¯Ÿåˆ†æ
        - çŸ¥è¯†èå…¥ï¼šè§£è°œå·¥å…·ã€å‘ç°è§„å¾‹ã€ç†è§£æœºåˆ¶ã€æ¢ç´¢å¥¥ç§˜

        **ğŸŒ¸ è½»æ¾å‹å…³å¡**
        - å¯¹è¯è½®æ¬¡ï¼š10-18è½®ï¼ˆæ…¢èŠ‚å¥ï¼Œå……åˆ†äº’åŠ¨äº¤æµï¼‰
        - æƒ…ç»ªçŠ¶æ€ï¼šæ„‰å¿«ã€æ”¾æ¾ã€æ¸©é¦¨ã€æ»¡è¶³æ„Ÿ
        - å¯¹è¯ç‰¹ç‚¹ï¼šæ¸©å’Œäº²åˆ‡ã€å¹½é»˜äº’åŠ¨ã€é¼“åŠ±æ€§å¼ºã€èŠ‚å¥èˆ’ç¼“ã€å¤šé—²èŠ
        - çŸ¥è¯†èå…¥ï¼šè‡ªç„¶äº¤æµã€æœ‰è¶£æ¸¸æˆã€è½»æ¾ç»ƒä¹ ã€å‹å¥½å¸®åŠ©

        ã€è¾“å‡ºæ ¼å¼ã€‘

        è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼Œç¡®ä¿æ˜¯æœ‰æ•ˆçš„JSONï¼š

        ```json
        {
          "äººç‰©æ¡£æ¡ˆ": {
            "ä¸»è§’": {
              "è§’è‰²å": "[ä»Story Frameworkæå–ä¸»è§’åç§°]",
              "å¤–è²Œ": "[ä»Story Frameworkæå–ä¸»è§’å¤–è²Œæè¿°]",
              "æ€§æ ¼": "[ä»Story Frameworkæå–ä¸»è§’æ€§æ ¼ç‰¹ç‚¹]",
              "ç‰¹æ®Šèƒ½åŠ›": "[ä»Story Frameworkæå–ä¸»è§’ç‰¹æ®Šèƒ½åŠ›]"
            },
            "NPC": {
              "è§’è‰²å": "[ä»Story Frameworkæå–NPCåç§°]",
              "å¤–è²Œ": "[ä»Story Frameworkæå–NPCå¤–è²Œæè¿°]",
              "æ€§æ ¼": "[ä»Story Frameworkæå–NPCæ€§æ ¼ç‰¹ç‚¹]",
              "ä½œç”¨": "[ä»Story Frameworkæå–NPCåœ¨æ•…äº‹ä¸­çš„ä½œç”¨]"
            }
          },
          "äººç‰©å¯¹è¯": [
            {
              "è½®æ¬¡": 1,
              "NPC": "[åŸºäºStory Frameworkçš„è§’è‰²æ€§æ ¼ï¼Œç»“åˆScene Dataçš„åœºæ™¯æ°›å›´å¼€åœºå¯¹è¯]",
              "ä¸»è§’": "[ç¬¦åˆStory Frameworkè§’è‰²è®¾å®šå’Œå½“å‰åœºæ™¯æ°›å›´çš„å›åº”]"
            },
            {
              "è½®æ¬¡": 2,
              "NPC": "[æ¨è¿›Story Frameworkæ•…äº‹çº¿å’ŒScene Dataå‰§æƒ…çš„å¯¹è¯]",
              "ä¸»è§’": "[ä½“ç°Story Frameworkè§’è‰²æˆé•¿å’Œåœºæ™¯äº’åŠ¨çš„å›åº”]"
            }
          ]
        }
        ```

        **äº’åŠ¨è§£è°œç¯èŠ‚**
        å›°å¢ƒæè¿°ï¼š[NPCåŸºäºStory Frameworkçš„æƒ…èŠ‚è®¾è®¡å’ŒScene Dataçš„å‰§æœ¬æè¿°å½“å‰å›°å¢ƒ]

        æ¢ç´¢å¼•å¯¼ï¼š[NPCå¼•å¯¼ç©å®¶è§‚å¯ŸScene Dataåœºæ™¯ä¸­çš„çº¿ç´¢ï¼Œå‘ç°è§£å†³æ€è·¯]

        è€ƒæ ¸è®¾è®¡ï¼š
        - è€ƒæ ¸ç±»å‹ï¼š[ä¸¥æ ¼æŒ‰ç…§Story Frameworkä¸­æŒ‡å®šçš„äº’åŠ¨æ–¹å¼é€‰æ‹©ï¼šé€‰æ‹©é¢˜/å¡«ç©ºé¢˜/æ‹–æ‹½æ’åº/æ•°å­—è¾“å…¥/æ“ä½œæ¨¡æ‹Ÿç­‰]
        - é¢˜ç›®æè¿°ï¼š[å°†Story Frameworkçš„æ•™å­¦ç›®æ ‡åŒ…è£…æˆè°œé¢˜ï¼Œæ”¾ç½®åœ¨Scene Dataçš„åœºæ™¯æƒ…å¢ƒä¸­]
        - å…·ä½“é¢˜ç›®ï¼š[æ˜ç¡®çš„é—®é¢˜è¡¨è¿°ï¼Œä½“ç°Story Frameworkçš„çŸ¥è¯†ç‚¹è¦æ±‚]
        - äº¤äº’è®¾ç½®ï¼š[æ ¹æ®Story Frameworkçš„äº’åŠ¨æ–¹å¼è¦æ±‚è®¾è®¡å…·ä½“äº¤äº’ï¼š
          * é€‰æ‹©é¢˜ï¼šæä¾›3-4ä¸ªé€‰é¡¹åŠå…¶æè¿°
          * å¡«ç©ºé¢˜ï¼šè¯´æ˜å¡«ç©ºä½ç½®å’Œæç¤ºä¿¡æ¯
          * æ‹–æ‹½é¢˜ï¼šè¯´æ˜æ‹–æ‹½å…ƒç´ å’Œç›®æ ‡ä½ç½®
          * æ•°å­—è¾“å…¥ï¼šè¯´æ˜è¾“å…¥èŒƒå›´å’Œæ ¼å¼è¦æ±‚
          * æ“ä½œæ¨¡æ‹Ÿï¼šè¯´æ˜å…·ä½“æ“ä½œæ­¥éª¤å’Œåˆ¤æ–­æ ‡å‡†]
        - æ­£ç¡®ç­”æ¡ˆï¼š[åŸºäºStory Frameworkæ•™å­¦è¦æ±‚çš„æ ‡å‡†ç­”æ¡ˆ]
        - ç­”æ¡ˆè§£æï¼š[è§£é‡Šä¸ºä»€ä¹ˆæ­£ç¡®ï¼Œä¸Story FrameworkçŸ¥è¯†ç‚¹çš„å…³è”]

        åé¦ˆæœºåˆ¶ï¼š
        - å®Œå…¨æ­£ç¡®ï¼š[ä½“ç°Story Frameworkæ•™å­¦ç›®æ ‡è¾¾æˆï¼Œè¥é€ Scene Dataåœºæ™¯æ°›å›´çš„åº†ç¥+å‰§æƒ…å¥–åŠ±+å…³ç³»å‘å±•]
        - éƒ¨åˆ†æ­£ç¡®ï¼š[åŸºäºStory Frameworkæ•™å­¦è¦æ±‚çš„æŒ‡å¯¼æç¤ºï¼Œä¿æŒScene Dataåœºæ™¯æ°›å›´çš„é¼“åŠ±]  
        - å®Œå…¨é”™è¯¯ï¼š[æä¾›Story FrameworkçŸ¥è¯†ç‚¹ç›¸å…³çš„å­¦ä¹ çº¿ç´¢ï¼Œç»´æŒScene Dataåœºæ™¯æ°›å›´çš„å¼•å¯¼é‡è¯•]

        ã€è´¨é‡æ ‡å‡†ã€‘
        - ä¸¥æ ¼æŒ‰ç…§Story Frameworkçš„æ•™å­¦ç›®æ ‡ã€äº’åŠ¨æ–¹å¼ã€è§’è‰²è®¾å®šã€æƒ…èŠ‚æ•…äº‹çº¿è¿›è¡Œè®¾è®¡
        - åˆ©ç”¨Scene Dataçš„åœºæ™¯æè¿°å’Œå‰§æœ¬å†…å®¹è¥é€ æ°›å›´å’Œæ¨è¿›æƒ…èŠ‚
        - å¯¹è¯è¦æœåŠ¡äºStory Frameworkçš„æ•™å­¦ç›®çš„
        - åœºæ™¯è¡¨ç°è¦ä½“ç°Scene Dataçš„è§†è§‰å’Œå‰§æƒ…è®¾è®¡
        - ç¡®ä¿Story Frameworkçš„å®Œæ•´æ€§ä¼˜å…ˆï¼ŒScene Dataä½œä¸ºè¡¨ç°è½½ä½“

        è¯·æ ¹æ®ä»¥ä¸Šè¦æ±‚ï¼Œä»¥Story Frameworkä¸ºä¸»å¯¼ï¼Œç»“åˆScene Dataçš„åœºæ™¯å‰§æœ¬ï¼Œä¸ºç¬¬{level}å…³å¡ç”Ÿæˆå®Œæ•´çš„è§’è‰²å¯¹è¯è„šæœ¬ã€‚"""
        
        return PromptTemplate(
            input_variables=["story_framework", "scene_data", "level"],
            template=template
        )

    def get_level_scenes_generation_prompt(self) -> PromptTemplate:
        """è·å–å…³å¡åœºæ™¯å‰§æœ¬ç”Ÿæˆæ¨¡æ¿"""
        template = """èŠ‚å¥æ„ŸçŸ¥åœºæ™¯å‰§æœ¬ç”ŸæˆPrompt
ä½ æ˜¯ä¸€å"å‰§æƒ…é©±åŠ¨æ•™è‚²æ¸¸æˆåˆ†é•œè®¾è®¡å¸ˆ"ã€‚ä½ çš„ä»»åŠ¡æ˜¯åŸºäºStory Frameworkä¸ºç¬¬{level}å…³åˆ›é€ æ²‰æµ¸å¼çš„å†’é™©åˆ†é•œï¼Œå…¶ä¸­å­¦ç§‘çŸ¥è¯†æ˜¯è§£å†³å›°å¢ƒã€æ¨è¿›å‰§æƒ…çš„æ ¸å¿ƒå·¥å…·ã€‚

ã€æ ¸å¿ƒè®¾è®¡ç†å¿µã€‘
- å­¦ç§‘çŸ¥è¯†å¿…é¡»æ˜¯è§£å†³å‰§æƒ…å›°å¢ƒçš„å”¯ä¸€é€”å¾„
- è§’è‰²æœ‰çœŸå®çš„åŠ¨æœºå’Œç›®æ ‡ï¼Œé‡åˆ°çœŸå®çš„å›°éš¾
- å­¦ä¹ è¿‡ç¨‹ä¼ªè£…æˆ"å‘ç°ä¸–ç•Œè§„å¾‹"å’Œ"è§£è°œæ¢ç´¢"
- é¿å…"è€å¸ˆå‡ºé¢˜"æ¨¡å¼ï¼Œé‡‡ç”¨"ä¼™ä¼´æ¢ç´¢"æ¨¡å¼
ğŸ­ èŠ‚å¥é€‚é…ï¼šæ ¹æ®å…³å¡ç‰¹ç‚¹è°ƒæ•´åœºæ™¯æ°›å›´å’Œå‰§æƒ…èŠ‚å¥ï¼Œåˆ›é€ ä¸°å¯Œçš„æƒ…æ„Ÿä½“éªŒå±‚æ¬¡

ã€Story Frameworkã€‘
{story_framework}

ã€å½“å‰ä»»åŠ¡ã€‘
è¯·åˆ†æStory Frameworkä¸­çš„"å…³å¡{level}"éƒ¨åˆ†ï¼Œç”Ÿæˆè¯¥å…³å¡çš„å®Œæ•´åˆ†é•œå†…å®¹ã€‚

ã€å…³å¡èŠ‚å¥è¯†åˆ«ä¸åœºæ™¯é€‚é…ã€‘
é¦–å…ˆåˆ†æå…³å¡ç‰¹ç‚¹ï¼Œåˆ¤æ–­åº”é‡‡ç”¨çš„åœºæ™¯æ°›å›´ç±»å‹ï¼š

**ğŸ”¥ ç´§å¼ å‹åœºæ™¯**ï¼ˆå±æœºå…³å¡ã€bossæˆ˜ã€æ½œå…¥ã€æ—¶é—´é™åˆ¶ç­‰ï¼‰
- åœºæ™¯æ°›å›´ï¼šé«˜å‹ã€ç´§è¿«ã€å±é™©æ„Ÿã€è‚¾ä¸Šè…ºç´ é£™å‡
- å‰§æœ¬èŠ‚å¥ï¼šå¿«é€Ÿæ¨è¿›ã€ç›´å¥”ä¸»é¢˜ã€å°‘æè¿°å¤šè¡ŒåŠ¨
- æ—¶é•¿ä¼°è®¡ï¼š5-8åˆ†é’Ÿï¼ˆå¿«èŠ‚å¥ï¼‰
- è§†è§‰ç‰¹ç‚¹ï¼šæš—è‰²è°ƒã€é”åˆ©æ„å›¾ã€åŠ¨æ€å…‰å½±ã€ç´§å¼ æ°›å›´
- çŸ¥è¯†èå…¥ï¼šç”Ÿæ­»å…³å¤´çš„ç²¾ç¡®è®¡ç®—ã€å…³é”®æ—¶åˆ»çš„æ•‘å‘½å·¥å…·

**ğŸ” æ¢ç´¢å‹åœºæ™¯**ï¼ˆæ£®æ—å…¥å£ã€æ–°ç¯å¢ƒã€è°ƒæŸ¥çº¿ç´¢ã€è§£è°œç­‰ï¼‰
- åœºæ™¯æ°›å›´ï¼šç¥ç§˜ã€å¥½å¥‡ã€é€æ­¥å‘ç°ã€æç„¶å¤§æ‚Ÿ
- å‰§æœ¬èŠ‚å¥ï¼šä¸­ç­‰æ¨è¿›ã€æè¿°ä¸è¡ŒåŠ¨å¹¶é‡ã€å±‚å±‚æ­ç¤º
- æ—¶é•¿ä¼°è®¡ï¼š8-12åˆ†é’Ÿï¼ˆä¸­ç­‰èŠ‚å¥ï¼‰
- è§†è§‰ç‰¹ç‚¹ï¼šæŸ”å’Œå…‰çº¿ã€å¹³è¡¡æ„å›¾ã€æ¸å˜è‰²è°ƒã€æ¢ç´¢æ°›å›´
- çŸ¥è¯†èå…¥ï¼šè§£è°œé’¥åŒ™ã€å‘ç°è§„å¾‹ã€ç†è§£æœºåˆ¶ã€æ¢ç´¢å¥¥ç§˜

**ğŸŒ¸ è½»æ¾å‹åœºæ™¯**ï¼ˆç¾ä¸½åœºæ™¯ã€å‹å–„NPCã€åº†ç¥æ—¶åˆ»ã€æ—¥å¸¸äº’åŠ¨ç­‰ï¼‰
- åœºæ™¯æ°›å›´ï¼šæ¸©é¦¨ã€æ„‰å¿«ã€æ”¾æ¾ã€æ»¡è¶³æ„Ÿã€æˆé•¿å–œæ‚¦
- å‰§æœ¬èŠ‚å¥ï¼šèˆ’ç¼“æ¨è¿›ã€å……åˆ†æè¿°ã€æƒ…æ„Ÿäº¤æµã€å…³ç³»æ·±åŒ–
- æ—¶é•¿ä¼°è®¡ï¼š10-15åˆ†é’Ÿï¼ˆæ…¢èŠ‚å¥ï¼‰
- è§†è§‰ç‰¹ç‚¹ï¼šæ˜äº®è‰²è°ƒã€æ¸©é¦¨æ„å›¾ã€æŸ”å’Œå…‰çº¿ã€å’Œè°æ°›å›´
- çŸ¥è¯†èå…¥ï¼šè‡ªç„¶äº¤æµã€æœ‰è¶£æ¸¸æˆã€è½»æ¾ç»ƒä¹ ã€å‹å¥½åˆ†äº«

ã€æ°›å›´åŒ¹é…çš„è®¾è®¡åŸåˆ™ã€‘

1) **æ°›å›´é©±åŠ¨çš„å›°å¢ƒè®¾è®¡**ï¼š
   - å›°å¢ƒçš„ç´§è¿«ç¨‹åº¦è¦ä¸åœºæ™¯ç±»å‹åŒ¹é…
   - ğŸ”¥ ç´§å¼ å‹ï¼šçœŸå®å¨èƒã€æ—¶é—´é™åˆ¶ã€é«˜é£é™©åæœ
   - ğŸ” æ¢ç´¢å‹ï¼šè°œé¢˜éšœç¢ã€æœªçŸ¥æŒ‘æˆ˜ã€éœ€è¦æ™ºæ…§
   - ğŸŒ¸ è½»æ¾å‹ï¼šå‹å¥½å›°éš¾ã€æˆé•¿æœºä¼šã€æ¸©å’ŒæŒ‘æˆ˜

2) **èŠ‚å¥æ„ŸçŸ¥çš„å‰§æƒ…è®¾è®¡**ï¼š
   - å‰§æœ¬å†…å®¹è¦ä¸åœºæ™¯æ°›å›´å®Œå…¨åŒ¹é…
   - ğŸ”¥ ç´§å¼ å‹ï¼šå¿«é€Ÿæ¨è¿›çš„å±æœºå¤„ç†ï¼Œé«˜æ½®è¿­èµ·
   - ğŸ” æ¢ç´¢å‹ï¼šå±‚å±‚é€’è¿›çš„å‘ç°è¿‡ç¨‹ï¼Œæç„¶å¤§æ‚Ÿ
   - ğŸŒ¸ è½»æ¾å‹ï¼šèˆ’ç¼“æ¸©é¦¨çš„æˆé•¿æ—¶åˆ»ï¼Œæƒ…æ„Ÿæ·±åŒ–

3) **æ°›å›´ä¸€è‡´çš„è§†è§‰è®¾è®¡**ï¼š
   - å›¾ç‰‡æç¤ºè¯è¦ä½“ç°åœºæ™¯æ°›å›´çš„è§†è§‰ç‰¹å¾
   - ğŸ”¥ ç´§å¼ å‹ï¼šæš—è‰²è°ƒã€é”åˆ©çº¿æ¡ã€åŠ¨æ€æ„å›¾ã€æˆå‰§æ€§å…‰å½±
   - ğŸ” æ¢ç´¢å‹ï¼šæŸ”å’Œå…‰çº¿ã€å¹³è¡¡æ„å›¾ã€æ¸å˜è‰²å½©ã€ç¥ç§˜æ°›å›´
   - ğŸŒ¸ è½»æ¾å‹ï¼šæ˜äº®è‰²è°ƒã€æ¸©é¦¨æ„å›¾ã€æŸ”å’Œå…‰çº¿ã€å’Œè°ç”»é¢

ã€è¾“å‡ºæ ¼å¼ã€‘

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¾“å‡ºï¼Œç¡®ä¿æ˜¯æœ‰æ•ˆçš„JSONï¼š

```json
{
  "åˆ†é•œåŸºç¡€ä¿¡æ¯": {
    "åˆ†é•œç¼–å·": "scene_{level}",
    "åˆ†é•œæ ‡é¢˜": "å…³å¡{level}-[åœºæ™¯åç§°]",
    "åœºæ™¯èŠ‚å¥ç±»å‹": "ğŸ”¥ç´§å¼ å‹ / ğŸ”æ¢ç´¢å‹ / ğŸŒ¸è½»æ¾å‹",
    "åœºæ™¯æ°›å›´": "[å…·ä½“çš„æ°›å›´æè¿°ï¼Œä½“ç°èŠ‚å¥ç±»å‹ç‰¹ç‚¹]",
    "æ—¶é•¿ä¼°è®¡": "[æ ¹æ®èŠ‚å¥ç±»å‹è°ƒæ•´çš„æ—¶é•¿]",
    "å…³é”®äº‹ä»¶": "[ç¬¦åˆåœºæ™¯æ°›å›´çš„å…·ä½“äº‹ä»¶æè¿°]"
  },
  "å›¾ç‰‡ç”Ÿæˆæç¤ºè¯": {
    "è§†è§‰é£æ ¼": "[ä¸Story Frameworkä¸–ç•Œè§‚å’Œåœºæ™¯æ°›å›´åŒ¹é…çš„è‰ºæœ¯é£æ ¼]",
    "åœºæ™¯æè¿°": "[æ ¹æ®èŠ‚å¥ç±»å‹è°ƒæ•´çš„å…·ä½“è§†è§‰æ°›å›´ï¼ŒåŒ…æ‹¬è‰²è°ƒã€å…‰å½±ã€æ„å›¾ç‰¹ç‚¹]",
    "è§’è‰²æè¿°": "[åŸºäºåœºæ™¯æ°›å›´çš„è§’è‰²è¡¨ç°å’ŒåŠ¨ä½œçŠ¶æ€]",
    "æ„å›¾è¦æ±‚": "[æ ¹æ®åœºæ™¯èŠ‚å¥é€‰æ‹©çš„æœ€ä½³æ„å›¾æ–¹å¼]",
    "æŠ€æœ¯å‚æ•°": "é«˜åˆ†è¾¨ç‡ï¼Œ16:9æ¨ªç‰ˆæ„å›¾ï¼Œé€‚åˆç§»åŠ¨ç«¯æ¸¸æˆç•Œé¢å±•ç¤º"
  },
  "å‰§æœ¬": {
    "æ—ç™½": "[æ ¹æ®åœºæ™¯èŠ‚å¥ç±»å‹è¥é€ ç›¸åº”æ°›å›´çš„å¼€åœºæè¿°]",
    "æƒ…èŠ‚æè¿°": "[åŒ¹é…åœºæ™¯æ°›å›´çš„å®Œæ•´å†’é™©å¼§çº¿ï¼Œä½“ç°ç›¸åº”çš„èŠ‚å¥æ„Ÿå’Œæƒ…æ„Ÿå¼ºåº¦]",
    "äº’åŠ¨è®¾è®¡": "[æ ¹æ®åœºæ™¯ç±»å‹è°ƒæ•´çš„å­¦ä¹ æœºåˆ¶åŒ…è£…æ–¹å¼ï¼Œç¡®ä¿æ°›å›´ä¸€è‡´æ€§]"
  }
}
```

ã€æ ¼å¼è¦æ±‚ã€‘
- æ‰€æœ‰å­—æ®µå¿…é¡»å¡«å†™ï¼Œä½“ç°åœºæ™¯æ°›å›´ç‰¹ç‚¹
- åœºæ™¯æ°›å›´è¦ä¸èŠ‚å¥ç±»å‹å®Œå…¨åŒ¹é…ï¼Œé¿å…æ°›å›´å†²çª
- å‰§æœ¬å†…å®¹è¦çªå‡ºç›¸åº”çš„èŠ‚å¥æ„Ÿå’Œæƒ…æ„Ÿå¼ºåº¦
- å›¾ç‰‡æç¤ºè¯å¿…é¡»ä½“ç°åœºæ™¯æ°›å›´çš„è§†è§‰ç‰¹å¾
- **å…³é”®**ï¼šæ•´ä¸ªåˆ†é•œçš„æ‰€æœ‰å…ƒç´ éƒ½è¦æœåŠ¡äºåŒä¸€ç§æ°›å›´è¥é€ 
- **é¿å…**ï¼šåœ¨åŒä¸€åˆ†é•œä¸­æ··åˆä¸åŒèŠ‚å¥ç±»å‹çš„å…ƒç´ 
- ä½¿ç”¨ç®€æ´çš„æ–‡æ¡£æ ¼å¼ï¼Œç”¨ä»£ç å—æ ‡è®°å›¾ç‰‡æç¤ºè¯å’Œå‰§æœ¬æ®µè½å†…å®¹

è¯·ä¸¥æ ¼æŒ‰ç…§ä¸Šè¿°è¦æ±‚ç”Ÿæˆæ°›å›´ä¸€è‡´çš„åˆ†é•œè„šæœ¬ã€‚"""

        return PromptTemplate(
            input_variables=["story_framework", "level"],
            template=template
        )


# ä¾¿åˆ©å‡½æ•°
def create_prompt_templates() -> PromptTemplates:
    """åˆ›å»ºæç¤ºè¯æ¨¡æ¿å®ä¾‹çš„ä¾¿åˆ©å‡½æ•°"""
    return PromptTemplates()


# æµ‹è¯•å‡½æ•°
def test_templates():
    """æµ‹è¯•æ¨¡æ¿ç”Ÿæˆæ•ˆæœ"""
    templates = create_prompt_templates()

    # æµ‹è¯•åŸºç¡€æ¨¡æ¿
    print("=== åŸºç¡€ä¿¡æ¯æ”¶é›†æ¨¡æ¿ ===")
    basic_prompt = templates.get_prompt_by_stage("basic_info")
    formatted = basic_prompt.format(
        history="ç”¨æˆ·ï¼šä½ å¥½\nåŠ©æ‰‹ï¼šæ‚¨å¥½ï¼Œæˆ‘æ¥å¸®æ‚¨è®¾è®¡æ•™è‚²æ¸¸æˆ",
        input="æˆ‘æƒ³åšä¸€ä¸ªæ•°å­¦æ¸¸æˆ"
    )
    print(formatted)

    # æµ‹è¯•åŠ¨æ€æ¨¡æ¿
    print("\n=== åŠ¨æ€æ¨¡æ¿ ===")
    collected_info = {
        "subject": "æ•°å­¦",
        "grade": "ä¸‰å¹´çº§",
        "knowledge_points": None,
        "teaching_goals": None
    }

    lacked_info = {
        "stage": "basic_info",
        "missing_fields": ["knowledge_points"],
        "missing_details": {"knowledge_points": "éœ€è¦æ˜ç¡®å…·ä½“çŸ¥è¯†ç‚¹"},
        "completion_rate": 0.67
    }

    dynamic_prompt = templates.generate_dynamic_prompt("basic_info", collected_info, lacked_info)
    formatted_dynamic = dynamic_prompt.format(
        history="ç”¨æˆ·ï¼šä¸‰å¹´çº§æ•°å­¦æ¸¸æˆ\nåŠ©æ‰‹ï¼šå¾ˆå¥½ï¼Œè¯·å‘Šè¯‰æˆ‘å…·ä½“çš„çŸ¥è¯†ç‚¹",
        input="åŠ æ³•è¿ç®—"
    )
    print(formatted_dynamic)


if __name__ == "__main__":
    test_templates()